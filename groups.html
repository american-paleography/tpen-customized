<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
            <title>Project Management</title>
            <link type="text/css" href="http://localhost:8080/newberry/css/custom-theme/jQuery.css" rel="Stylesheet" />
            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script> 
            <style type="text/css" >
                #editProjectMembers{
                    position: relative;
                }
            </style>
    </head>
    <div>
        <div class="closeBtn" onclick="$('#projectUserManagement').hide();">X</div>
        <h4>Add a new group member (must have a T&#8209;PEN account)</h4>

        <div id="addUserToGroup">
           <label for="adduname">Username (e-mail) </label><input id="adduname" type="text"/>
           <label for="addfname">First Name </label><input id="addfname" type="text"/>
           <label for="addlname">Last Name </label><input id="addlname" type="text"/>
           <input type="button" value="Add User" onclick="addUserToProject();"/>
        </div>

        <h4>Create a new Group</h4>
        <div id="createNewGroup">
            <input type="text" name="groupName" value="Group Name"/>
            <input type="button" value="Create Group"/>
         </div>

        <h4>Existing Members</h4>
        <ul id="editProjectMembers" class="isMember">

        </ul>
    </div>
</html>
<script type="text/javascript">
    
    function addUserToProject(){
        var uname = $("#adduname").val();
        var fname = $("#addfname").val();
        var lname = $("#addlname").val();
        var url="http://localhost:8080/newberry/addUserToProject"; 
        var params = {"projectID":currentProjectID, "uname":uname, "fname":fname, "lname":lname};
        $.post(url,params);
//        if(jqXHR.status && jqXHR.status==401){
//                     alert("You must be logged in and be the admin of this project"); 
//                }
//                else if (jqXHR.status && jqXHR.status==406){
//                    alert("The user you are attempting to add does not exist or the projectID is incorrect.");
//                }
        
    }
             
    function promoteUserToAdmin(uid){
        var url="http://localhost:8080/newberry/changeUserPermission";
        var params = {"projectID":currentProjectID, "act":"changerole", "role":"leader", "uid":uid};
        $.post(url, params);
//        if(jqXHR.status && jqXHR.status==403){
//                     alert("You must specify a project ID."); 
//                }
//                else if (jqXHR.status && jqXHR.status==406){
//                    alert("This is not an existing role or permission");
//                }
//                else if (jqXHR.status && jqXHR.status==0){
//                    alert("This user is not a memeber of the group.");
//                }
//                else if (jqXHR.status && jqXHR.status==1){
//                    alert("Success");
//                }
//                else if (jqXHR.status && jqXHR.status==11){
//                    alert("User is already in the group.");
//                }
        
    }
            
    function removeUserFromProject(username){
        var url="http://localhost:8080/newberry/delUserFromProject";
        var params = {"uname":username, "projectID":currentProjectID};
        $.post(url, params);
//        if(jqXHR.status && jqXHR.status==401){
//                     alert("You must be logged in and be the admin of this project"); 
//                }
//                else if (jqXHR.status && jqXHR.status==406){
//                    alert("The user you are attempting to add does not exist or the projectID is incorrect.");
//                }
        
    }

    function createNewGroup(){
        var url="http://localhost:8080/newberry/";
        //POST
    }
    
    $(function() {

       $('.delete').hover(function()
       {
          $(this).parent().addClass("strikeout");
       },
               function() {
                  $(this).parent().removeClass("strikeout");
               }
       );

       $('.promoteUser').click(function() {
          if(userIsProjectAdmin){
              var name = $(this).parent('li').text();
               var nIn = name.indexOf('Remove');
               if (nIn > 3)
                  name = name.substring(0, nIn - 1);
               var cfrm = confirm('This action will grant ' + name +
                       ' complete access as a Group Leader and cannot be undone.\n\nAre you sure?');
               return cfrm;
          }
          else{
               var errorMsg = confirm("You must have the proper permissions to complete this action. ")
               return errorMsg;
          }

       });
    });
      </script>