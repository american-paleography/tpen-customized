<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <meta charset="UTF-8">
        <title>TPEN Transcription</title>
        <link type="text/css" href="css/custom-theme/jQuery.css" rel="Stylesheet" />
        <link  href="http://fonts.googleapis.com/css?family=Nova+Cut:regular&v1" rel="stylesheet" type="text/css" >
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.js"></script>
<!--        <script type="text/javascript" src="js/tpen.js"></script>
        <script type="text/javascript" src="js/transcription.js"></script>-->
    </head>
    <style>
    
    #transcriptionTemplate{
        height: 98%;
        width: 100%;
        position: relative;
        display: none;
        margin-top:35px;
    }
    
    .transcriptlet {
      display:block;
      left:0;
      margin:0 12.5%;
      opacity:1;
      position:relative;
      top:0;
      visibility:visible;
      width:auto;
      z-index:3;
    }

    .transcriptletBefore {
      opacity:0;
      position:absolute;
      top:-60px;
      visibility:hidden;
    }

    .transcriptletAfter {
      opacity:0;
      position:absolute;
      top:100px;
      visibility:hidden;
    }

    #workspace textarea {
      font-family:Cambria,Georgia, serif!important;
      left:0;
      margin:0 auto;
      max-height:12em;
      min-height:60px;
      position:relative;
      right:0;
      width:100%;
      z-index:5;
    }

    #bookmark {
      -moz-box-shadow:0 0 15px #000;
      -webkit-box-shadow:0 0 15px #000;
      border:thin solid #A64129;
      box-shadow:0 0 15px #000;
      height:0;
      left:-600%;
      opacity:1!important;
      position:absolute;
      z-index:2;
    }

    #imgTop,#imgBottom {
      display:block;
      height:35%;
      overflow:hidden;
      position:relative;
      width:100%;
      z-index:1;
    }

    #imgBottom {
      height:100%;
      z-index:2;
    }

    #imgTop img,#imgBottom img {
      display:block;
      left:0;
      position:absolute;
      top:0;
      width:100%;
      max-height: none !important; 
      z-index:inherit;
    }

    #workspace {
      background:#FFF;
      box-shadow:0 6px 32px 4px #000;
      display:block;
      padding:12px 4px;
      position:relative;
      width:100%;
      z-index:3;
    }

    #captions {
      min-height:2em;
      position:relative;
    }
   
    /*
    * Transcription transition movements.  
    */

   #bookmark {
       -webkit-transition: width .25s, height .5s, left .25s, top .5s;
       -moz-transition: width .25s, height .5s, left .25s, top .5s;
       -o-transition: width .25s, height .5s, left .25s, top .5s;
       transition: width .25s, height .5s, left .25s, top .5s;
   }
   /*#imgTop,#imgBottom {
       -webkit-transition: height .25s, width .5s;
       -moz-transition: height .25s, width .5s;
       -o-transition: height .25s, width .5s;
       transition: height .25s, width .5s;
   }*/
   #imgTopImg,#imgBottom img {
       -webkit-transition: left .5s, top .5s, width .5s;
       -moz-transition: left .5s, top .5s, width .5s;
       -o-transition: left .5s, top .5s, width .5s;
       transition: left .5s, top .5s, width .5s;
   }
   #imgTop, #imgBottom {
       -webkit-transition: left .5s, top .5s, width .5s;
       -moz-transition: left .5s, top .5s, width .5s;
       -o-transition: left .5s, top .5s, width .5s;
       transition: left .5s, top .5s, width .5s;
   }
   .transcriptlet,#blogLink {
       -webkit-transition: opacity .5s, top .5s;
       -moz-transition: opacity .5s, top .5s;
       -o-transition: opacity .5s, top .5s;
       transition: opacity .5s, top .5s;
   }
   
   #transcriptionText{
       height:100px;
       width:80%;
       position: relative;
   }
   
   #transcriptionCanvas{
       position:relative;
       height:inherit;
   }
   
   .instructions{
       position: relative;
       height:auto;
       width:auto;
       font-size: 14px;
       color:red;
       margin-bottom:10px;
   }

    </style>
    <body>
        <input type="button" onclick="testMakeTranscriptionLineWithStore()" value="new line test" />
        <input type="button" onclick="testUpdateLineWithStore()" value="update line test" />
        <div class="instructions">
            <p>
                The area below accepts a project ID number, a project url, or a object (a JSON object) as valid input.  It will then load a manifest
                to the interface for you to interact with the transcription tool.  You can click {AN AREA I HAVE NOT CREATED} to edit the line parsings if you do not like the 
                result the automatic parser gave you or lines you have previously created.  Since it accepts projects as valid input, you can click {BUTTONS I HAVE NOT CREATED} to
                go through the various folios in the manifest your project is built around or use the {DROPDOWN I NEED TO CREATE} to jump to a specific page.  
                This will save all lines on the folio you were just transcribing to preserve changes.
            </p>
            <p>
                Once you have decided what to put into the area, click 'Load Transcription' to have the input created into the transcription interface. If you are done with the folio you are
                working on and want to move to another project click 'Enter a New Transcription Object'.  This will quit the transcription interface for the project you are working on.  It is possible
                that the line you were currently working on is not saved, so make sure to to click 'Save Lines' before you quit. 
            </p>
            <p>
                Once the interface is loaded, you can move from line to line to add your transcription to the line.  When you move from one line to another, your changes to the line you were just one
                are saved.  You can click 'Save Lines' to save all of your lines at any time.
            </p>
        </div>
        
        <div id="setTranscriptionObjectArea">
            <textarea id="transcriptionText"></textarea>
            <input type="file" id="transcriptionFile" required="true" multiple="false" />
        </div>
        
        <input type="button" value="Load Transcription" onclick="loadTranscription();" /> <input type="button" value="Enter A New Transcription Object" onclick='resetTranscription();'/>
        
        <div id="transcriptionTemplate">
            <input type="button" class="save&exit" style="position: absolute; right:23%;" value="Save & Exit" />
            <div id="transcriptionCanvas">
                <div id="bookmark"></div>
                <div id="imgTop">
                  <img class="transcriptionImage"/>
                </div>
              <div id="workspace">
                <div id="captions"></div>
                <button style="position: absolute; bottom:0" onclick="saveTransLines();" >Save Lines</button>
                <button style="position: absolute; right:0;" id="nextTranscriptlet" onclick="nextTranscriptlet();"> NEXT </button>
                <button style="position: absolute; left:0;" id="previousTranscriptlet" onclick="previousTranscriptlet();"> PREVIOUS </button>
              </div>
                <div id="imgBottom">
                <img class="transcriptionImage" />
              </div><br>
            </div>
          </div>
    </body>
    
</html>
<script type="text/javascript">
    var transcriptionCanvases = [];
    var focusItem = [null,null];
    var transcriptionFile = "";
    var transcriptionObject = {};
    var projectID = 4351;
    
    //Update and save have the same function.  You pass in the objectID to update, or no object ID to create a new one. 
    function testUpdateLineWithStore(){
        //var objectID = 101164975; //first line of project. 
        var namespace = "mycom/hanyan"; //mycom is domain name but for testing we are using my computer. 
        var content = "testedUPDATE";
        var selector = "x=51,y=51,w=101,h=201";
        var title = "updatedTITLE";
        var resource = "http://localhost:8080/T-PEN/imageResize?folioNum=13186850&height=2000"; //image url
        var resourceType = "image"; //image
        var outerRelative = "projectID:4351, folio:13186850"; //folio it belongs to.  Need to also have projectID so that this entry will be unique. 
        //var addedTime = "";
        //var fontColor = "black";
        //var fontType = "";
        var permission = 1;
        var url = "http://localhost:8080/T-PEN/updateTransLineServlet";
        var params = {"objectID":objectID, "namespace":namespace, "content":content, "selector":selector, "title":title,
            "resource":resource, "resourceType":resourceType, "outerRelative":outerRelative, "permission":permission};
        $.post(url, params);
    }
    
    function testMakeTranscriptionLineWithStore(){
        var namespace = "mycom/hanyan";
        var content = "tested";
//        var selector = "x=5,y=50,w=100,h=200";
        var title = "title";
        var resource = "http://localhost:8080/T-PEN/imageResize?folioNum=13186850&height=2000"; //image url
        var resourceType = "image"; //image
//        var outerRelative = "projectID:4351, folio:13186850"; //folio it belongs to.  Need to also have projectID so that this entry will be unique. 
//        var addedTime = "";
        //var fontColor = "black";
       // var fontType = "";
        var permission = 2;
        var url = "http://localhost:8080/T-PEN/saveNewTransLineServlet";
//        var params = {"namespace":namespace, "content":content, "selector":selector, "title":title, 
//            "resource":resource, "resourceType":resourceType, "outerRelative":outerRelative, "permission":permission};
        var params = {"namespace":namespace, "content":content, "title":title, 
            "resource":resource, "resourceType":resourceType, "permission":permission};
        $.post(url, params);
    }
    
    /* Test if a given string can be parsed into a valid JSON object.
     * @param str  A string
     * @return bool
     */
    function isJSON(str) {
        var r = true;
        if(typeof str === "object"){
            console.log('str is an object');
            r = true;
        }
        else{
            try {
                JSON.parse(str);
                r=true;
            } 
            catch (e) {
               console.log('str could not be parsed: '+e);
               r = false;
            }
        }
        return r;
    };
    
    /*
     * Clear the page to load another transcription.
     * 
     * FOR SOME REASON when loading the transcription the the .load() function runs twice and I do not know why.  None of the transcriptlets recieve the transcriptletAfter class.
     * since this is taking too much time to figure out, I am forcing a page refresh when this button in clicked (problem in firefox). 
     */
    function resetTranscription(){
        window.location.reload();
//        transcriptionCanvases = [];
//        focusItem = [null,null];
//        transcriptionFile = "";
//        transcriptionObject = {};
//        projectID = 0;
//        console.log('NEW RESET CODE!');
//        $('#setTranscriptionObjectArea').show();
//        $('#transcriptionText').html("");
//        $('#transcriptionTemplate').hide();
//        $('#bookmark').css({left:"-600%", height:"0px"});
//        $('#imgTop').css('height', '0px');
//        $('#captions').empty();
//        $('.transcriptionImage').attr('src', '');
//        $('.transcriptlet').remove();
//       
//        console.log('Reset Ran');
    }
    
    /*
     * Load the trnascription from the text in the text area. 
     */
    function loadTranscription(){
        //Object validation here.
        console.log('LOAD CLIKED');
        //Project ID is not part of the manifest data.  When a user gets to transcription, we already need to know the project ID.
            projectID = 4351;
            var userTranscription = $('#transcriptionText').val();
//            console.log(userTranscription);
//            console.log($.isNumeric(userTranscription));
            if($.isNumeric(userTranscription)){ //The user can put the project ID in directly and a call will be made to T-PEN proper to grab it.
                projectID = userTranscription;
                //Put a header in saying it is cross origin and who I am.
                var projectRequest = new XMLHttpRequest();
                var url = "http://localhost:8080/T-PEN/project/"+userTranscription;
                $.ajax({
                    url: url,
                    success: function(projectData){
                        if(projectData.sequences[0] !== undefined && projectData.sequences[0].canvases !== undefined
                        && projectData.sequences[0].canvases.length > 0){
                            console.log("loading tran canvas")
                            loadTranscriptionCanvas(projectData.sequences[0].canvases[0]);
                        }
                        else{
                            //ERROR! It is a malformed transcription object.  There is no canvas sequence defined.  
                        }
                    },
                    error: function(jqXHR,error, errorThrown) {  
                        if(jqXHR.status && jqXHR.status==400){
                             alert(jqXHR.responseText); 
                        }
                        else{
                            alert("Something went wrong");
                        }
                   }
                });
            }
            else if (userTranscription.indexOf("/project/") >= 0){
                projectID = parseInt(userTranscription.lastIndexOf('/project/'));
                $.ajax({
                    url: userTranscription,
                    success: function(projectData){
                        if(projectData.sequences[0] !== undefined && projectData.sequences[0].canvases !== undefined
                        && projectData.sequences[0].canvases.length > 0){
                            console.log('loading trans canvas 2');
                            loadTranscriptionCanvas(projectData.sequences[0].canvases[0]);
                        }
                        else{
                            //ERROR! It is a malformed transcription object.  There is no canvas sequence defined.  
                        }
                    },
                    error: function(jqXHR,error, errorThrown) {  
                        if(jqXHR.status && jqXHR.status==400){
                             alert(jqXHR.responseText); 
                        }
                        else{
                            alert("Something went wrong");
                        }
                    }
                });
            }
            else{
                if(isJSON(userTranscription)){
                    userTranscription = JSON.parse(userTranscription);
                    if(userTranscription.sequences[0] !== undefined && userTranscription.sequences[0].canvases !== undefined
                    && userTranscription.sequences[0].canvases.length > 0){
                        console.log('load trans canvas 3')
                        loadTranscriptionCanvas(userTranscription.sequences[0].canvases[0]);
                        $('#transcriptionTemplate').show();
                        $('#setTranscriptionObjectArea').hide();
                    }
                    else{
                        //ERROR!  It is a valid JSON object, but it is malformed and cannot be read as a transcription object. 
                    }
                }
                else{
                    //ERROR!  Not a valid JSON object

                }
            }
    }
    
    /*
     * Load a canvas from the manifest to the transcription interface. 
     */
    function loadTranscriptionCanvas(canvasObj){
//        console.log('Load Trans...');
//        console.log('Set Image...');
        $('#transcriptionTemplate').show();
        console.log('IN LOAD FUNCTION')
        if(canvasObj.resources[0].resource['@id'] !== undefined && canvasObj.resources[0].resource['@id'] !== ""){
            $('.transcriptionImage').attr('src', canvasObj.resources[0].resource['@id'].replace('amp;',''));
        }
        else{
            //ERROR!  Malformed canvas object.  
        }
        $("#imgTop").find('img').load(function(){
            console.log('ONLY RUN ONCE I AM CHECKING FOR ONLY THE FIRST IMAGE LOADIMNG');
            console.log('Image Loaded.  Draw Lines.');
            drawLinesToCanvas(canvasObj);
        });
        $('.transcriptionImage').error(function(){
            $(this).attr('src', basePath+"/images/missingImage.png");
        });
    }
    
    /*
     * @paran canvasObj  A canvas object to extrac transcription lines from and draw to the interface. 
     */
    function drawLinesToCanvas(canvasObj){
        console.log('IN DRAW LINES');
        var image = $('#imgTop').find('.transcriptionImage');
        var lines = [];
        var theHeight = image.height();
        var theWidth = image.width();
        var ratio = theWidth / theHeight;
        var counter = 0;
        var update = true;
        var thisContent = "";
        $('#transcriptionCanvas').css('height', theHeight);
        if(canvasObj.resources !== undefined && canvasObj.resources.length > 0){
            for(var i=1; i<canvasObj.resources.length; i++){
                lines.push(canvasObj.resources[i]);
            }
        }
        else{
            //ERROR! Malformed canvas object.  
            update = false;
        }
        
        //will run on an empty array if object is malformed. 
        $.each(lines, function(){
            var line = this;
            var x,y,w,h = 0;
            var XYWHarray = [x,y,w,h];
            var lineURL = "";
            var lineID = -1;
            if(line.on !== undefined){
                lineURL = line.on;
            }
            else{
                //ERROR.  malformed line.
                update = false;
            }
            if(line["@id"] !== undefined && line['@id'].indexOf('line') >=0 ){
                lineID = line['@id'].substring(line['@id'].lastIndexOf('line/') + 5);
            }
            else{
                //ERROR.  Malformed line. 
                update = false;
            }
            thisContent = "";
            if(lineURL.indexOf('#') > -1){ //string must contain this to be valid
                var XYWHsubstring = lineURL.substring(lineURL.lastIndexOf('#' + 1)); //xywh = 'x,y,w,h'
                if(XYWHsubstring.indexOf('=') > -1){ //string must contain this to be valid
                    var numberArray = XYWHsubstring.substring(lineURL.lastIndexOf('xywh=') + 5).split(',');
                    if(numberArray.length === 4){ // string must have all 4 to be valid
                        x = numberArray[0];
                        y = numberArray[1];
                        w = numberArray[2];
                        h = numberArray[3];
                        XYWHarray = [x,y,w,h];
                    }
                    else{
                        //ERROR! Malformed line
                        update = false;
                    }
                }
                else{
                    //ERROR! Malformed line
                    update = false;
                }
            }
            else{
                //ERROR!  Malformed line.
                update = false;
            }
            if(line.resource['cnt:chars'] !== undefined){
                thisContent = line.resource['cnt:chars'];
                var newAnno = $('<div id="transcriptlet_'+counter+'" lineID="'+counter+'" lineServerID="'+lineID+'" class="transcriptlet" data-answer="' + thisContent + '"><textarea>'+thisContent+'</textarea></div>');
                newAnno.attr({
                    lineLeft: parseFloat(XYWHarray[0]) / (10 * ratio),
                    lineTop: parseFloat(XYWHarray[1]) / 10,
                    lineWidth: parseFloat(XYWHarray[2]) / (10 * ratio),
                    lineHeight: parseFloat(XYWHarray[3]) / 10,
                    counter: counter
                });
                counter += 1;
                $("#workspace").append(newAnno);
            }
            else{
                //ERROR! malformed line
            }
        });
        
        if(update){
            console.log('Update presentation');
            updatePresentation($('.transcriptlet').eq(0));
        }
    }
    
    function updatePresentation(transcriptlet) {
        console.log('In update with focus item = '+focusItem);
        focusItem[0] = focusItem[1];
        focusItem[1] = transcriptlet;
        if ((focusItem[0] === null) || (focusItem[0].attr("id") !== focusItem[1].attr("id"))) {
          console.log('adjust + set and swap 1');
          this.adjustImgs(this.setPositions());
          this.swapTranscriptlet();
//          this.updateCaptions();
          //show previous line transcription
          $('#captions').animate({
            opacity: 1
          }, 100);
        } 
        else {
            console.log('adjust + set 2')
          this.adjustImgs(this.setPositions());
          //this.maintainWorkspace();
        }
        //prevent textareas from going invisible and not moving out of the workspace
        focusItem[1].removeClass("transcriptletBefore transcriptletAfter");
    //        if(document.activeElement.id === "transcriptionPage"){
    //            // nothing is focused on somehow
    //            focusItem[1].find('.theText')[0].focus();
    //        }
      }
      
     function setPositions() {
    //Determine size of section above workspace
        if (focusItem[1].attr("lineHeight") !== null) {
          var bookmarkPadding = 0;
          var currentLineHeight = parseFloat(focusItem[1].attr("lineHeight"));
          var currentLineTop = parseFloat(focusItem[1].attr("lineTop"));
          var imageHeight = $('#transcriptionCanvas').height();
          // top of column
          var previousLine = (focusItem[1].prev().is('.transcriptlet') && (currentLineTop > parseFloat(focusItem[1].prev().attr("lineTop")))) ? parseFloat(focusItem[1].prev().attr("lineHeight")) : parseFloat(focusItem[1].attr("lineTop"));
          // oversized for screen
          var imgTopHeight = (previousLine + currentLineHeight)+1.5; // obscure behind workspace. TODO
          // topImgPosition, bookmarkTop - other bookmark dimensions stored in hidden inputs
          var topImgPosition = ((previousLine - currentLineTop)*100)/imgTopHeight;
    //      var bookmarkTop = ((previousLine/imgTopHeight)*100 - bookmarkPadding);
          var bookmarkTop = (currentLineTop + (((imgTopHeight)/100)*topImgPosition)); //+ (topImgPosition*imgTopHeight)/ imageHeight)
     //     var bookmarkHeight = (currentLineHeight/(imgTopHeight)*100 + 2 * bookmarkPadding);
          // bottomImgPosition
          var bottomImgPosition = -(currentLineTop + currentLineHeight);
        }
        var positions = {
          imgTopHeight: imgTopHeight,
          topImgPosition: topImgPosition,
          bottomImgPosition: bottomImgPosition,
          bookmarkTop: bookmarkTop,
          bookmarkHeight: currentLineHeight
        };
        return positions;
  };
  
  /**
   * Removes previous textarea and slides in the new focus.
   *
   * @see updatePresentation()
   */
    function swapTranscriptlet() {
      //focusItem[0].addClass("transcriptletBefore").removeClass('noTransition');
      // slide in the new transcriptlet
      console.log('IN SWAP FUNCTION');
      focusItem[1].css({"width": "auto", "z-index": "5"});
      focusItem[1].removeClass("transcriptletBefore transcriptletAfter");
      focusItem[1].prevAll(".transcriptlet").addClass("transcriptletBefore").removeClass("transcriptletAfter");
      focusItem[1].nextAll(".transcriptlet").addClass("transcriptletAfter").removeClass("transcriptletBefore");
      console.log($('.transcriptletAfter').length, $('.transcriptletBefore').length);
      if($('.transcriptletAfter').length == 0){
          $('#nextTranscriptlet').hide();
      }
      else{
          $('#nextTranscriptlet').show();
      }
      if($('.transcriptletBefore').length == 0){
          $('#previousTranscriptlet').hide();
      }
      else{
           $('#previousTranscriptlet').show();
      }
    };
    
  /**
   * Aligns images and workspace using defined dimensions.
   *
   * @see maintainWorkspace()
   */
    function adjustImgs(positions) {
      //move background images above and below the workspace
      console.log('IN ADJUST IMAGES')
          $("#imgTop").animate({
            "height": positions.imgTopHeight + "%"
          },250)
          .find("img").animate({
            top: positions.topImgPosition + "%",
            left: "0px"
          },250);
          positions.bookmarkLeft = $(focusItem[1]).attr('lineLeft');
          positions.bookmarkWidth = $(focusItem[1]).attr('lineWidth');
          $('#bookmark').animate({
            left: positions.bookmarkLeft + "%",
            top: positions.bookmarkTop + "%",
            height: positions.bookmarkHeight + "%",
            width: positions.bookmarkWidth + "%"
          },350);
          $("#imgBottom").find("img").animate({
            top: positions.bottomImgPosition + "%",
            left: "0px"
          },250);
    }
    
    function saveTransLines(){
        $('.transcriptlet').each(function(){
            var currentLineServerID = $(this).attr('lineServerID');
            var currentLineText = $(this).find('textarea').val();
            var url = "http://localhost:8080/T-PEN/updateLine?text="+currentLineText+"&projectID="+projectID+"&line="+currentLineServerID;
            var updateRequest = new XMLHttpRequest();
            updateRequest.open("POST", url, true);
  //          updateRequest.setRequestHeader("Access-Control-Allow-Origin", "Access-Control-Allow_Origin:*");
            updateRequest.send();
        });
        
    }
  
    /*
     * The UI control for going the the next transcriptlet in the transcription. 
     */
    function nextTranscriptlet() {
          var nextID = parseFloat(focusItem[1].attr('lineID')) + 1;
          var currentLineServerID = focusItem[1].attr("lineServerID");
          var currentLineText = focusItem[1].find('textarea').val(); //.val() does not work.
          var url = "http://localhost:8080/T-PEN/updateLine?text="+currentLineText+"&projectID="+projectID+"&line="+currentLineServerID;
          var updateRequest = new XMLHttpRequest();
          updateRequest.open("POST", url, true);
//          updateRequest.setRequestHeader("Access-Control-Allow-Origin", "Access-Control-Allow_Origin:*");
          updateRequest.send();
          updatePresentation($('#transcriptlet_'+nextID));
    }
    
    /*
     * The UI control for going the the previous transcriptlet in the transcription. 
     */
    function previousTranscriptlet() {
          var prevID = parseFloat(focusItem[1].attr('lineID')) - 1;
          var currentLineServerID = focusItem[1].attr("lineServerID");
          var currentLineText = focusItem[1].find('textarea').val();
          var url = "http://www.tpen.org/TPEN/updateLine?text="+currentLineText+"&projectID="+projectID+"&line="+currentLineServerID;
          var updateRequest = new XMLHttpRequest();
          updateRequest.open("POST", url, true);
          updateRequest.send();
          updatePresentation($('#transcriptlet_'+prevID));
    }
    
    function nextFolio(){
        
    }
    
    function previousFolio(){
        
    }

    $(function(){
        //Get canvases that are a part of this transcription.  Only load the first one.                  
        $('.transcriptlet').focusin(function() {
            console.log('FOCUS ON A TRANSCRIPLET!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
            var item = $(this);
//            updatePresentation(item);
        });
        
        $('#transcriptionFile').on("change", function(event){
            //start spinny?
            console.log("change");
            var selectedFile = event.target.files[0];
            var reader = new FileReader();
            var result = $('#transcriptionText')
            reader.onload = function(event){
              var fileContent = event.target.result;
              var fileParse = "";
//              console.log(fileContent);
//              var fileLines = fileContent.split('\n');
//              $.each(fileLines,function(){
//                  console.log(this);
//                  fileParse += this+'\n';
//              })
              result.html(fileContent);
              $('#transcriptionTemplate').hide();
              // stop spinny?
            };
            reader.readAsText(selectedFile);
        });
    });
</script>
