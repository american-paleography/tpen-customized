<!DOCTYPE html>
<!--
Open the project management section for a given project ID.
-->
<html>
    <head>
        <title>Project Management</title>
        <link type="text/css" href="css/custom-theme/jQuery.css" rel="Stylesheet" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script> 
        <script type="text/javascript" src="js/newberry.js"></script>
        <link rel="stylesheet" href="css/newberryTransSkin.css" type="text/css">
        <!--
        <link rel="stylesheet" href="css/print.css" type="text/css" media="print">
        -->

        <style type="text/css" >
            #folioManagement{
                display: none;
                position: absolute;
                top:100px;
                z-index: 1000;
                background: url("images/ui-bg_dots-medium_75_ffebb9_4x4.png") repeat scroll 50% 50% #FFEBB9;
                padding:8px;
                box-shadow: 1px 1px 1px 1px;
                width: 60%;
            }
            #projectMetadataWrapper{
                display: none;
                position: absolute;
                z-index:1000;
                top:100px;
            }
            #projectUserManagement{
                display: none;
                position: absolute;
                top:100px;
                z-index: 1000;
                background: url("images/ui-bg_dots-medium_75_ffebb9_4x4.png") repeat scroll 50% 50% #FFEBB9;
                padding:8px;
                box-shadow: 1px 1px 1px 1px;
            }
            .promoteUser{
                font-weight: bold;
            }
            .closeBtn{position: absolute;  top: 10px;  right:10px; z-index:1000; cursor:pointer;}
            #publicProjectNotice, .permitRead, .permitModify, .permitCopy, .permitButtons, .permitMetadata, .permitAdmin, .isMember, .mustBeAdmin{display:none;}
            #footer { width: 1010px; position: fixed;left:0;right:0; bottom:0;margin: 0 auto;}
            #foot { background: url(images/footer.png) top left no-repeat;position:relative;padding:50px 125px; }
            #button { text-decoration: none; }
            body,#wrapper {height: 100%;max-height: 100%;overflow: visible;}
            #project, #ms, #team, #options, #export { margin: 0; padding: 0;}
            #project li, #ms li, #team li,#export li {padding: 0.4em; padding-left: 1.5em; height: 100%;overflow: hidden; float:left; width:32%; position: relative;margin-right: 1%;}
            #project li ul,#ms li ul,#team li ul, #options li ul, #export li ul {padding: 0;margin: 0;}
            #project li ul li,#ms li ul li,#team li ul li,  #export li ul li {list-style:outside none;padding:0;width:100%;height:100%;}
            #options li{
                padding: 0.4em; padding-left: 1.5em; max-height: 590px; overflow: auto; float:left; width:30%; position: relative;margin-right: 1%;
            }
            
            #project div.tall {position: absolute;right:0;width: 29%;}
            #project div.tall li {position: absolute;right:20px;height:48%;margin:0;width:100%;min-height: 120px;}
            #project div.tall li:last-child {bottom:-13px;min-height: 80px;}
            #projectList {max-height: 300px;overflow: auto;}
            #projectList li {margin: 0;}
            a.tpenButton,button.tpenButton {padding: 2px; margin:2px; display:block;text-align: center; text-decoration: none;min-width: 90px;min-height:16px; cursor:pointer;}
            .stretch {font-size: 0.8em !important;}
            .shrink {width: 3em !important;font-size: 0.8em !important;}
            .grow {width:7em !important;}
            .bold, span.bold input {font-weight: bold; border: none;}
            span.bold input {width: 60px; font-size: .8em;}
            .ui-icon-closethick:hover {background-image: url(css/custom-theme/images/ui-icons_cd0a0a_256x240.png);}
            .disabled { margin: 0 3px 3px 23px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px;width:650px;}
            #addToProject,#addingTools {position: fixed; top:25%; left:25%; width:50%; display: none;z-index: 501;}
            #addingTools {
                box-shadow: 0 0 0 2000px rgba(0,0,0,.4);
                padding: 10px;
            }
            #addToolCommit, #addToolPreview {
                display: block;
                float: left;
            }
            #addToolName, #addToolURL {
                display: block;
                width: 50%;
            }
            #addToolFrame{
                float: right;
                height: 350px;
                width: 50%;
                position: relative;}
            #addToProject:after {
                content: "";
                width: 100%;
                height: 100%;
                position: fixed;
                pointer-events:none;
                z-index: 500;
                box-shadow: 0 0 200px black inset;
                top: 0;
                left: 0;}
            #form {height: 425px; margin: 0 auto; width:515px;border-width: 1px; 
                   -webkit-box-shadow: -1px -1px 12px black;
                   -moz-box-shadow: -1px -1px 12px black;
                   box-shadow: -1px -1px 12px black;
            }
            .delete {position:absolute;top:6px;right:6px;}
            input.text {width:100%;}
            #logFilter a:not(#openNote) {width:46%;float:left;margin-left: 1%;}
            #closePopup:hover {color: crimson;cursor: pointer;}
            .label {text-align: right; margin-right: 10px;}
            #inviteFeedback span {display:block;}
            #currentSetting {font-weight: bold;}
            #currentSetting:before {content:'Currently set to: "';color:black;font-weight: normal;}
            #currentSetting:after {content:'"';color:black;font-weight: normal;}
            .loadingBook {background-position: center center !important;}
            #xmlImport,#xmlValidate,#linebreaking,#wordbreak,#inviteUser,#template {margin:-4px 5px 2px;background: url(images/linen.png);padding:6px 2px 2px;display:none;overflow: hidden;z-index: 1; border: 1px solid #A68329;
                                                                                    -moz-box-shadow: -1px -1px 2px black;
                                                                                    -webkit-box-shadow: -1px -1px 2px black; 
                                                                                    box-shadow:-1px -1px 2px black;}
            #xmlImportBtn,#xmlValidateBtn,#linebreakingBtn,#wordbreakBtn,#inviteUserBtn,#templateBtn {padding:2px;text-align: center;position: relative;z-index: 2;cursor: pointer;width:100%;-o-box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:-ms-border-box;box-sizing:border-box;}
            #template label {width: 100%;}
            #template textarea {height: 3em;max-width: 100%;}
            .format{padding:2px;text-align: center;position: relative;z-index: 2;cursor: pointer;}
            .formatDiv{margin:-4px 5px 2px;clear:left;background: url(images/linen.png);padding:6px 2px 2px;display:none;overflow: hidden;z-index: 1; border: 1px solid #A68329;
                       -moz-box-shadow: -1px -1px 2px black;
                       -webkit-box-shadow: -1px -1px 2px black; 
                       box-shadow:-1px -1px 2px black;}
            #pdfOptions {display:block;}
            #exportLinebreakString,#exportWordbreak{width: 40px;}
            #quickExport span.choices {width:32%;float:left;position:relative;padding:15px 0;margin-bottom: -4px;}
            #quickExport {position:relative;}
            #quickExport input[type=radio] {visibility:visible;position: absolute;}
            .xmlRemove {display: none;clear: left;}
            .xmlShow {clear:left;}
            .xmlTags, .specialCharacters {display:block;}
            #quickExport h4 {position: relative;margin-bottom: 0;}
            .xmlFormat span {display: block;float:left;clear:left;width:40%;max-height: 18px;overflow: hidden;}
            #pageRange select {max-width: 175px;position: absolute;left:110px;}
            #exportTags select {position: absolute;right: 90px;}
            #samplePreview {overflow: hidden;position: relative;}
            #samplePreview img {width: auto;height: auto; position: absolute;left:0;top:30px;}
            #samplePreview h3 {position:relative;z-index: 2;}
            #samplePreview img, #samplePreview h3 {cursor: -moz-zoom-in, move;}
            #export label {font-weight: normal;width:auto;margin:0; padding:0;line-height: 24px; float: none;} /* override defaults */
            #export h3 {margin-top: 1em;margin-bottom: 0;}
            #export button {padding:8px 4px;width:33%;margin:0px;height:50px;}
            .xmlDisclaimer {display:none;float: left;clear: left;}
            #exportAlert {display: none;width:100%;}
            .partnerListing {width:100%;padding:2px;}
            .partnerName {width:100%;font-size: 125%;font-family: serif;display: block;}
            .partnerDescription {width:100%;padding:3px;margin:2px;display: block;white-space: normal;}
            .partnerSelected {background: green;}
            #QENI {overflow: auto;width: 100%;}
            #tpenSubmit,#disconnect {width:100%;margin-bottom: 1.25em;}
            #deleteConnection{display: none;}
            span + h4[id] {margin-top:1.25em;}
            .projectTools,.userTools {font-weight: normal;width: auto;padding: 0;clear: left;}
            #customHeader {margin: 1em;background-color: rgba(255,255,255,.5);padding: .5em;display: block;color: gray;border:thin solid gray;overflow: auto;text-overflow:ellipsis;max-height: 300px;font-size: smaller;}
            #projectOrdering {position: fixed !important;width:50% !important;right:auto !important;} /* battling weird Chrome bug */ 
    </style>
    </head>
    <body>
        <input type="hidden" id="activeProjectID" />
        <div id="wrapper">
            <div id="header"><p align="center" class="tagline">transcription for paleographical and editorial notation</p></div>
            <div id="content">
                <h1><script>document.write(document.title); </script></h1>
                <p>Use this page to coordinate your team, design customized projects from available manuscripts, and make fine adjustments to individual pages.</p>
                <!--    LOADING BAR            
                <div id="outer-barG">
                    <div id="front-barG" class="bar-animationG">
                        <div id="barG_1" class="bar-lineG">
                        </div>
                        <div id="barG_2" class="bar-lineG">
                        </div>
                        <div id="barG_3" class="bar-lineG">
                        </div>
                    </div>
                </div>-->
                <div id="editProjectMetadata"></div>
                
                <div id="tabs">
                    <ul class="toptabs">
                        <li><a title="Switch between projects or manage pages" href="#tabs-1">Projects</a></li>
<!--                        <li><a title="Alter linebreaks and parsings" href="#tabs-2">Manuscripts</a></li>-->
                        <li><a title="Organize your team" href="#tabs-3">Collaboration</a></li>
                        <li><a title="Project Options" href="#tabs-4">Options</a></li>
<!--                        <li><a title="Export Options" href="#tabs-5">Export</a></li>-->
                    </ul>
                    <div id="tabs-1">
                        <ul id="project" class="ui-helper-reset">
                            <li class="ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <h3>Project Selection</h3>
                                <!-- Only show this if user is not a member of the project -->
                                <p id="publicProjectNotice" class="ui-state-highlight">You are viewing public project, <span id="publicProjectName" class="loud bold">THIS PROJECT's NAME</span>. To manage one of your own projects, click below.</p>
                                
                                <p id="activeProject">Active project is <span id="activeProjectName" class="loud"></span>.</p>
                                <p> To manage a different project, select below.</p>
                                <h6>All Your Projects</h6>
                                <ul id="projectList">
                                    
                                </ul>
<!--                                <div class="permitModify isMember">
                                    <h3>Start Another Project</h3>
                                    <a id="addManuscript" class="tpenButton mustBeAdmin" href="#"><span class="ui-icon ui-icon-plus right"></span>Get A Manuscript</a>
                                    <div id="uploadImagesDiv" class="mustBeAdmin"></div>
                                </div>-->
                            </li>
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <h3>Current Metadata Summary</h3>
                                    <!-- Check if user is a project memeber or allowed to see the metadata -->
                                    
                                    <!-- Check for a custom hedaer -->
                                    <a class="tpenButton ui-button" href="projectMetadata.jsp?resetHeader=true&projectID=PROJECTID>" id="emptyHeader">Remove Custom Header</a>
                                    <p>You have uploaded a custom header for this project, which is displayed below. This header is read-only. To change it, remove the current header and upload a new file.</p>
                                    <span id='customHeader'>Custom Header Goes Here</span>
                                    <!-- Check for header limitation -->
                                  <span id="lineBreakNotice" class='ui-state-error-text'></span>
                                    
                                <p>
                                    <span class="label">Title: <span class="metadataTitle"></span></span><br />
                                    <span class="label">Subtitle: <span class="metadataSubtitle"></span></span><br />
                                    <span class="label">MS&nbsp;Identifier: <span class="metadataMSID"></span></span><br />
                                    <span class="label">MS&nbsp;Settlement: <span class="metadataSettlement"></span></span><br />
                                    <span class="label">MS&nbsp;Repository: <span class="metadataRepository"></span></span><br />
                                    <span class="label">MS&nbsp;Collection: <span class="metadataCollection"></span></span><br />
                                    <span class="label">MS&nbsp;ID&nbsp;number: <span class="metadataMSIDnum"></span></span><br />
                                    <span class="label">Group&nbsp;Leader: <span class="metadataLeader"></span></span> <!-- GET group leader(s) -->
                                       <br />
                                    <span class="label">Description: <span class="metadataDescription"></span></span>
                                </p>
                                
                                <!-- Make sure user can update information -->
                                <div class="permitMetadata isMember">
                                    <p class="mustBeAdmin">To update any of this information:</p>
                                    <a class="tpenButton mustBeAdmin" onclick="$('#projectMetadataWrapper').show();"><span class="ui-icon ui-icon-tag right"></span>Update Metadata</a>
                                </div>
                         </li> 
<!--                            <div class="tall">
                                <li class="left ui-widget-content ui-corner-tr ui-corner-bl loadingBook">
                                     check for recently modified folios int recentFolio = thisProject.getLastModifiedFolio(); 
                                <a class='tpenButton' href='transcription.jsp?projectID=" + projectID + "&p=" + recentFolio + "'><span class='ui-icon ui-icon-pencil right'></span>Resume Transcribing</a> 
                                <a class='tpenButton' href='transcription.jsp?projectID=" + projectID + "'><span class='ui-icon ui-icon-pencil right'></span>First Page</a> 
                                 if(permitRead || permitModify || permitNotes || isMember) 
                                <div class="permitRead permitModify permitNotes isMember">   
                                    <select class="clear folioDropdown" style="margin: 10% 10%;text-align: center;max-width: 80%;" onchange="navigateTo(this);">
                                        <option SELECTED>Jump to page</option>
                                    </select>
                                </div>
                                </li>
                                 if(permitModify || isMember)
                                <div class="permitModify isMember">
                                    <li class="left ui-widget-content ui-corner-tr ui-corner-bl"><a class="tpenButton" onclick="$('#folioManagement').show();"><span class="ui-icon ui-icon-image right"></span>Modify image sequence</a>
                                </div>
                                <p>Change the order of or remove pages within this project.</p></li>
                            </div>-->
                        </ul>
                    </div>
                    <div id="tabs-3">
                        <ul id="team" class="ui-helper-reset">
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <div id="inviteFeedback"></div>
                                
<!--                                    User[] groupMembers = thisGroup.getMembers();
                                    User[] groupLeader = thisGroup.getLeader();
                                if ((UID == groupLeader[0].getUID()) && !thisProject.containsUserUploadedManuscript()){-->
                                <!--<a class="tpenButton mustBeAdmin" href="#publicOptions" onclick="$('#publicOptions').fadeIn('normal');return false;"><span class="ui-icon ui-icon-unlocked right"></span>Share Publicly</a>-->
<!--                                    if(isMember)-->
                                <a class="tpenButton isMember" onclick="showTeamMemberManagement();"><span class="ui-icon ui-icon-person right"></span>Modify Project Team</a>
                                <p>Add, delete, or just check your group membership on this project.</p>
                                <ul id="projectMembers" class="isMember">
                                    
                                </ul>
                               
                                <br />
                                <!--<div id="inviteUserBtn" class="tpenButton"><span class="ui-icon ui-icon-person right"></span>Invite to newberry</div>-->
                                <form id="inviteUser" class="ui-corner-all" name="invite" action="project.jsp" onsubmit="return simpleFormValidation();" method="get">
                                    <input type="hidden" name="projectID" value="PROJECTID">
                                    <input type="hidden" name="selecTab" value="2">
                                    <label for="uname">Email</label><input class="text" type="text" name="uname"/><br/>
                                    <label for="fname">First Name</label><input class="text" type="text" name="fname" /><br/>
                                    <label for="lname">Last Name</label><input class="text" type="text" name="lname"/><br/>
                                    <button type="submit" value="Register" name="invite" class="ui-button tpenButton"><span class="ui-icon ui-icon-person right"></span>Invite</button>
                                </form>
                            </li>

<!--                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall mustBeAdmin">
                                <h3>Recent Activity on this Project</h3>
                                <a id="popupNote" class="tpenButton" href="#"><span class="ui-icon ui-icon-comment right"></span>Add a note to the log</a>
                                <div id="projectLog" class="ui-corner-all">
                                    <%
                                        if (request.getParameter("submitted") != null) {
                                           try (Connection conn = ServletUtils.getDBConnection()) {
                                              String content = request.getParameter("logContent");
                                              thisProject.addLogEntry(conn, "<span class='log_user'></span>"+content, UID); // ,"userAdded"
                                           }
                                        }
                                        out.print(thisProject.getProjectLog());
                                    %>
                                </div>
                                    <div id="noteForm" class="ui-corner-all" style="display:none;">
                                        <form action="project.jsp?selecTab=2&projectID=<%out.print(projectID);%>" method="POST">
                                            <textarea name="logContent" id="logContent"></textarea><br>
                                            <button class="tpenButton left" type="submit" name="submitted" value="add comment" >Submit</button>
                                            <button class="tpenButton left" id="clearNote" name="cancel">Cancel</button>
                                        </form>
                                    </div>
                                            <div id="logFilter">
                                        Filters: userAdded, transcription, addMS, parsing           
                                    <a href="#" id="userAdded" filter="log_user" class="tpenButton" title="Filter notes added by users"><span class="right ui-icon ui-icon-person"></span>User Comment</a>
                                    <a href="#" id="transcription" filter="log_transcription" class="tpenButton" title="Filter automatic notes about new transcriptions"><span class="right ui-icon ui-icon-note"></span>Transcription</a>
                                    <a href="#" id="addMS" filter="log_manuscript" class="tpenButton" title="Filter automatic notes about additions to project"><span class="right ui-icon ui-icon-plus"></span>New Manuscript</a>
                                    <a href="#" id="parsing" filter="log_parsing" class="tpenButton" title="Filter automatic notes about changes in parsing"><span class="right ui-icon ui-icon-wrench"></span>Parsing Update</a>
                                    <a href="projectlog.jsp?projectID=<%out.print(projectID);%>" target="_blank" class="tpenButton clear" id="openNote"><span class="right ui-icon ui-icon-newwin"></span>View Log in a new window</a>
                                </div></li>-->
                        </ul>
                    </div>
                    <div id="tabs-4">
                        <ul id="options" class="ui-helper-reset">
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall permitModify isMember">
                                <h3>Project Options</h3>
<!--                                <%if(isMember || permitModify){%>
                                Import XML schema, validate projects, and customize buttons.
                                <div id="xmlImportDiv">
                                    <div id="xmlImportBtn" class="tpenButton"><span class="ui-icon ui-icon-script right"></span>
                                        Link a schema to this project
                                    </div>
                                    <a class="tpenButton" href="buttons.html"><span class="ui-icon ui-icon-gear right"></span>Button Management</a>
                                    <form id="xmlImport" name="xmlImport" class="ui-corner-all" action="project.jsp" method="POST">
                                        <input type="hidden" name="selecTab" value="3"/>
                                        <input type="hidden" name="projectID" value="PROJECTID"/>
                                        URL of schema:<input name="url" style="width:100%;margin:2px 0px 2px -1px" title="Link directly to a valid file" type="text" placeholder="enter complete file URL"/>
                                        <input class="tpenButton right" name="xmlImport" value="Link XML" type="submit" />
                                    </form>
                                </div>
                                <%}
                    if (thisProject.getSchemaURL().length() > 5) {%>
                                <div id="xmlValidateDiv">
                                    <div id="xmlValidateBtn" class="tpenButton"><span class="ui-icon ui-icon-script right"></span>
                                        Validate XML for this project
                                    </div>
                                    <form id="xmlValidate" class="ui-corner-all" action="validate" method="POST">
                                        <input type="hidden" name="selecTab" value="3"/>
                                        <input type="hidden" name="projectID" value="PROJECTID"/>
                                        URL of schema for validation: <div style="width:100%;margin:2px 0px 2px -1px">thisProject.getSchemaURL()></div>
                                        <input class="tpenButton right" name="xmlValidate" value="Validate" type="submit" />
                                    </form>
                                </div>
                                        <%if (isMember || permitButtons){%>
                                <a id="importBtnFromSchemaBtn" class="tpenButton permitButtons isMember" href="buttonSchemaImport.jsp?projectID=<%out.print(projectID);%>"><span class="ui-icon ui-icon-transfer-e-w right"></span>Import Buttons from Linked Schema</a>
                                <%}
                                }
                                if (isMember || permitButtons){%>
                                <a class="tpenButton permitButtons isMember" href="buttons.jsp?projectID=<%out.print(projectID);%>"><span class="ui-icon ui-icon-gear right"></span>Button Management</a>
                                <p>The <span title="Any unicode character can be attached to one of these buttons for use in your project." class="loud">Special Character</span> and <span title="Multiple custom tags with parameters can be added to this project." class="loud">Custom xml Tags</span> you define will remain specific to each project. These buttons are accessible on the transcription pages. Characters assigned to the numbered buttons can be inserted simply by holding CTRL and pressing the corresponding number on the keyboard.</p>
                           <%} else {%>
                               <p>Button management is restricted to group members on this public project. The current button pallete is displayed to the right.</p>
                           <%}
                           if ((isMember || permitCopy) && !thisProject.containsUserUploadedManuscript()){
         %>
                                <a id="copyProjectBtn" class="tpenButton permitCopy isMember" href="index.jsp?projectID=<%out.print(projectID);%>&makeCopy=true"><span class="ui-icon ui-icon-copy right"></span>Create a Copy</a>
                                <p>Create a new project with the same set of images, transcriptions, and buttons. Once copied, the projects will not synchronize cannot be recombined in T&#8209;PEN.</p>
                                <div id="publicOptions" class="ui-widget-content ui-corner-all mustBeAdmin">
                                    <a id="closePublicOption" href="#" onclick="$('#publicOptions').fadeOut('normal');return false;" class="right tpenButton ui-button">Close<span class="ui-icon ui-icon-close right"></span></a>

                                    <span id="publicOptionResult" class="right">Changes saved<span class="ui-icon ui-icon-check right"></span></span>

                                                        <%
                                    LET USER KNOW WHAT WILL HAPPEN IF THEY EDIT THESE OPTIONS AND THE PROJECT IS NOT PUBLIC
                                    %>
                                    <p class="ui-state-error ui-corner-all">
                                        <span class="ui-icon ui-icon-alert"></span>
                                        By default, only group members have access to the transcription and related project data. Changing any of these options will place this project on the Public Projects list.<br/>
                                        <span class="tpenButton ui-button center" onclick="$(this).parent().slideUp();">Acknowledged, thank you</span>
                                    </p>

-->
                                        <div id="publicOptionsSelection" class="mustBeAdmin">
                                            <h2>Public Access Options</h2>
                                            <div id="publicOptionsForm">
                                                <input type="hidden" value="PROJECTID">
                                                <input type="hidden" value="2" name="selecTab" />
                                                <h6>External Access</h6>
                                                <label for="OACr" class="publicLabel">
                                                    <!--<%if(permitOACr)out.print("checked");%>-->
                                                    <input id="OACr" name="OACr" type="checkbox" value="true" />OAC Read
                                                    <div class="publicDesc">
                                                        <h3>Open Annotation Collaboration</h3>
                                                            <code>Read Permission</code>
                                                            <p>This setting allows external (not originating from t&#8209;pen.org) tools and services to <strong>read</strong> data from the T&#8209;PEN database. Projects with this permission can load annotations and transcriptions into other tools and interfaces for in-depth processing not available on T&#8209;PEN.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting exposes your data <em>without authentication</em>.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Allowing this is not recommended unless you have a specific need in mind.</span>
                                                    </div>
                                                </label>
                                                <label for="OACw" class="publicLabel">
                                                    <!--<%if(permitOACw)out.print("checked");%>-->
                                                    <input id="OACw" name="OACw" type="checkbox"  value="true" />OAC Write
                                                    <div class="publicDesc">
                                                        <h3>Open Annotation Collaboration</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows external (not originating from t&#8209;pen.org) tools and services to write data from the T&#8209;PEN database. Projects with this permission can load annotations and transcriptions into other tools <em>and changes saved</em> for in-depth processing not available on T&#8209;PEN.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting exposes your data <em>without authentication</em>.</span>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Allowing this is not recommended unless you have a specific need in mind.</span>
                                                    </div>
                                                </label>
                                                <h6>View and Export</h6>
                                                <!--<%if(permitRead)out.print("checked");%>-->
                                                <label for="readTrans" class="publicLabel">
                                                    <input id="readTrans" name="readTrans" type="checkbox"  value="true" />View Project
                                                    <div class="publicDesc">
                                                        <h3>View Project</h3>
                                                            <code>Read Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>view</strong> this project in the transcription interface. Users cannot make any changes or view any data not revealed in the interface.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track viewers and provides no protections against manual copying.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-check"></span>This is the most restrictive way to make a project public.</span>
                                                    </div>
                                                </label>
                                                <label for="publicExport" class="publicLabel">
                                                    <!--<%if(permitExport)out.print("checked");%>-->
                                                    <input id="publicExport" name="publicExport" type="checkbox"  value="true" />Export Project
                                                    <div class="publicDesc">
                                                        <h3>Export Project</h3>
                                                            <code>Read Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>export</strong> this project through the T&#8209;PEN interface. Users cannot make any changes to original data.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track exports and provides no protections against copying.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Even without this permission, a clever and malicious user may capture data from any public project.</span>
                                                    </div>
                                                </label>
                                                <label for="projectCopy" class="publicLabel">
                                                    <!--<%if(permitCopy)out.print("checked");%> <%if(thisProject.containsUserUploadedManuscript())out.print("disabled title='This project contains private images.'");%>-->
                                                    <input id="projectCopy" name="projectCopy" type="checkbox"  value="true" />Copy Project
                                                    <div class="publicDesc">
                                                        <h3>Copy Project</h3>
                                                            <code>Read Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>copy</strong> this project and work independently. Users cannot make any changes to original data.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track copies and does not prevent a user from making the copy more public than the original.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>There is no way to merge or collate different branches of an original project.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Projects containing private images cannot be copied.</span>
                                                    </div>
                                                </label>
                                                <h6>Public Modifications</h6>
                                                <label for="modNotes" class="publicLabel">
                                                    <!--<%if(permitNotes)out.print("checked");%>-->
                                                    <input id="modNotes" name="modNotes" type="checkbox"  value="true" />Modify Notes
                                                    <div class="publicDesc">
                                                        <h3>Modify Notes</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any data in the notes fields. Changes are not restricted, but are tracked in the History with a username and timestamp.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>The transcription and notes fields are controlled by separate permissions.</span>
                                                    </div>
                                                </label>
                                                <label for="modTrans" class="publicLabel">
                                                    <!--<%if(permitModify)out.print("checked");%>-->
                                                    <input id="modTrans" name="modTrans" type="checkbox"  value="true" />Modify Transcription
                                                    <div class="publicDesc">
                                                        <h3>Modify Transcription</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any data in the transcription fields. Changes are not restricted, but are tracked in the History with a username and timestamp.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>The transcription and notes fields are controlled by separate permissions.</span>
                                                    </div>
                                                </label>
                                                <label for="modAnno" class="publicLabel">
                                                    <!--<%if(permitAnnotation)out.print("checked");%>-->
                                                    <input id="modAnno" name="modAnno" type="checkbox"  value="true" />Modify Annotations
                                                    <div class="publicDesc">
                                                        <h3>Modify Annotations</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any annotation. This includes insertion, deletion, and modification.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-info"></span>Only annotation modifications are allowed with this permission.</span>
                                                    </div>
                                                </label>
                                                <label for="modParsing" class="publicLabel">
                                                    <!--<%if(permitParsing)out.print("checked");%>-->
                                                    <input id="modParsing" name="modParsing" type="checkbox"  value="true" />Modify Line Parsing
                                                    <div class="publicDesc">
                                                        <h3>Modify Line Parsing</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> line parsing. This includes insertion, deletion, and modification.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>If a user deletes a column which contains transcription data, the attached data will also be removed.</span>
                                                    </div>
                                                </label>
                                                <label for="modButton" class="publicLabel">
                                                    <!--<%if(permitButtons)out.print("checked");%>-->
                                                    <input id="modButton" name="modButton" type="checkbox"  value="true" />Modify Buttons and Tags
                                                    <div class="publicDesc">
                                                        <h3>Modify Buttons</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any special character or XML tag buttons in the project (including addition and deletion).</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Changes to buttons are not tracked in the project log.</span>
                                                    </div>
                                                </label>
                                                <label for="modMetadata" class="publicLabel">
                                                    <!--<%if(permitMetadata)out.print("checked");%>-->
                                                    <input id="modMetadata" name="modMetadata" type="checkbox"  value="true" />Modify Metadata
                                                    <div class="publicDesc">
                                                        <h3>Modify Metadata</h3>
                                                            <code>Write Permission</code>
                                                            <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> project metadata or upload a custom header.</p>
                                                        <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                        <span class=""><span class="left ui-icon ui-icon-notice"></span>Changes to metadata are not tracked in the project log.</span>
                                                    </div>
                                                </label>
                                                    <input type="reset" value="Clear All" onclick="$('.publicLabel').children('input').prop('checked',false);return false;" class="tpenButton ui-button" />    
                                                <input onclick="updatePublicOptions();" type="button" name="publicOptions" value="Submit Changes"  class="tpenButton ui-button" />    
                                            </div>
                                        </div>
                                        </li>
                                        <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
<!--                                            <h3>Current Button Summary</h3>
                                            <h6>Special Character Buttons</h6>
                                            <div class="specialCharacters"></div>
                                            <br class="clear-left" />
                                            <h6>XML Tags</h6>
                                            <div class="xmlTags"></div>
                                           <p class="clear-left permitButtons isMember">If you wish, you can copy XML tags between projects: <a href="buttonProjectImport.jsp?a=1<%out.print(projectAppend);%>" class="ui-button tpenButton">Copy XML Tags</a></p>-->
                                           <div id="specChars">
                                                <div class="right" style="width:50%;">
<!--                                                    <h2>Hotkeys</h2>
                                                    <p>Enter the unicode value for each character.</p>
                                                    <a id="codeSearch" target="_blank" class="tpenButton ui-button ui-button-text-only" href="http://www.ssec.wisc.edu/~tomw/java/unicode.html"><span class="left ui-icon ui-icon-search"></span>Search for Codes</a>
                                                    <p>Buttons are mapped to the digits 1-9 on your keyboard. <span class="loud">Hold CTRL and press the corresponding number key</span> to insert one into your transcription.</p>
                                                    <p>Rearrange by clicking on the blue box and dragging to a new position. Click the X to remove a button.</p>
                                                    <p>You may add more than 9, but only the first 9 will be mapped to shortcuts.</p>-->
                                                    <div id="characterReview"><h5>Current Special Character Buttons</h5>
                                                        <div class="specialCharacters"></div>
                                                    </div>
                                                </div>
                                                    <ul id="sortable1" class="connectedSortable ui-helper-reset">

                                                </ul>
                                                <input type="button" id="addH" name="addH" class="tpenButton ui-button" value="Add a Button"/>
                                                <input type="submit" id="update" name="update" value="Save Changes" class="tpenButton ui-button"/><br><br>
                                            </div>
                                            <div id="custXML">
                                                <div class="right" style="width:440px;">
                                                    <h2>Custom XML Tags</h2>
                                                    <p>Add each tag without &lsaquo;angle brackets&rsaquo;, any parameters including &quot;quotes&quot; in the next 5 fields, and a description in the final field. Text in the <span class="loud">"description"</span> field will become the title of your button. Seek conciseness.</p>
                                                    <p>Rearrange by clicking on the blue box and dragging. Click the "X" icon to remove a button from the list. Add as many buttons as is useful. You will access them through the footer menu.</p>
                                                    <div id="xmlReview"><h5>Current Tags</h5>
                                                        <div class="xmlTags"></div>
                                                    </div>
                                                </div>
                                                <ul id="sortable2" class="connectedSortable ui-helper-reset">


                                                </ul>
                                                <input type="button" id="addT" name="addT" value="Add a Tag" class="tpenButton ui-button" onclick="document.getElementById('selecTab').value = 1;" />
                                                <input type="submit" onclick="document.getElementById('selecTab').value = 1;" id="update" name="update" value="Save Changes" class="tpenButton ui-button"/><br><br>
                                                <br />
                                            </div>
                                        <input type="hidden" name="selecTab" id="selecTab" value="0"/>
                                        </li>
                                        <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall permitModify isMember">
<!--                                        <h3>Transcription Tools</h3>
                                        <div id="userTools">
                                            <h4 class="clear-left" title="These options are unique to each user">User Tools</h4>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="abbreviations"/>Cappelli Abbreviations</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="compare" />Compare Pages</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="parsing" />Parsing Adjustment</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="preview" />Preview Tool</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="history" />History Tool</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="linebreak" />Linebreaking Tool</label>
                                            <label class='userTools'><input name="userTool" type="checkbox"  value="paleography" />Glyph Matching</label>
                                            <label class='userTools'><input name="userTool[]" type="checkbox" < %out.print(toolCheck[7]);% > value="sciat" />Annotations</label> 

                                        </div>
                                        <div id="projectTools">
                                            <span class="ui-helper-clearfix"></span><h4 id="projectTools" class="clear-left" title="These options are tied to each project">Project Tools
                                            <a class="ui-icon ui-icon-plusthick" id="addTool" title="Add a Tool" onclick="$('#addingTools').fadeIn();">Add a Tool</a>
                                            <span class="left clear-left small">(Click on a label to edit the button name)</span></h4>
                                        </div>-->
                                    </li>
                                </ul>
                            </div>
                               <!--<%}%>-->
                    <!--<%if (isMember || permitExport){%>-->
<!--                        <div id="tabs-5">
                            <%@include file="WEB-INF/includes/switchboardSubmit.jspf" %>
                        <%
                                }
                            }%>
                        <form action="export" method="get" onsubmit="return Export.validForm();">
                            <ul id="export" class="ui-helper-reset">
                                <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                    <button class="ui-state-default ui-button listBegin left" type="submit" value="Download File"><span class="ui-icon ui-icon-disk right"></span>Download File</button>
                                    <button class="ui-state-default ui-button left" type="submit" value="Open File"><span class="ui-icon ui-icon-document right"></span>Open File</button>
                                    <button class="ui-state-default ui-button listEnd" type="button" onclick="window.location.href='exportUI.jsp?projectID=<%out.print(projectID);%>&p=<%out.print(pageno);%>';return false;" title="Adjust settings in the browser for a highly customizable and portable document"><span class="ui-icon ui-icon-suitcase right"></span>HTML Export</button>
                                    <h3>File Format</h3>
                                    <label for="pdf" title="Portable Document Format"><input id="pdf" type="radio" checked name="type" value="pdf"/>PDF</label><br />
                                    <label for="rtf" title="Rich Text Format"><input id="rtf" type="radio" name="type" value="rtf">RTF</label><br />
                                    <label for="xml" title="XML/Plaintext"><input id="xml" type="radio" name="type" value="xml">XML/Plaintext</label><br />
                                                            </span>
                                                        <span class='label left clear-left'>Colors:</span>
                                                            <span class="left">
                                                                <label for="bw" title="Standard output"><input id="bw" type="radio" checked name="color" value="bw"/>Black &amp; White</label><br />
                                                                <label for="color" title="Colors are defined by the project buttons"><input disabled id="color" type="radio" name="color" value="color">Color Tags</label><br />
                                    <h3 class="clear">Metadata and Page Labels</h3>
                                    <p class="xmlDisclaimer">Metadata export and page labels are not supported in plaintext.</p>
                                    <span class="xmlHide">
                                        <label class="clear" id="paginationOption" for="paginationSelect" title="Include page labels in the exported document"><input id="paginationSelect" type="checkbox" name="pageLabels" checked />Check to Include Page Labels</label><br />
<%if (thisProject.getHeader().length()>0){%>
<label class="clear" id="metadataOption" for="metadataSelect" title="Include custom header in the exported document"><input id="metadataSelect" type="checkbox" name="metadata" checked />Check to Include Custom Header</label><br />
<%}else{%>
<label class="clear" id="metadataOption" for="metadataSelect" title="Include project metadata in the exported document"><input id="metadataSelect" type="checkbox" name="metadata" checked />Check to Include Project Metadata</label><br />
<%}%>
                                    </span>
                                    <label class="clear xmlDisclaimer" id="imageWrapOption" for="imageWrapSelect" title="Place an XML tag to indicate the reference image at each pagebreak"><input id="imageWrapSelect" type="checkbox" name="imageWrap" checked />Check to Include Image Tags</label><br />
                                    <h3 class="clear">Export Range</h3>
                                    <div id="pageRange">
                                        <label class="clear" for="beginFolio">Start with folio:<select id='beginFolio' class="beginFolio folioDropdown" name='beginFolio'></select></label><br/>
                                        <label class="clear" for="endFolio">End with folio:<select id='endFolio' class='endFolio folioDropdown' name='endFolio'></select></label>
                                    </div>
                                    <script type="text/javascript">
                                        var folioDropdown = $('<div />').append('<%
                                        String fdrop = "";
                                        try {
                                            fdrop = ESAPI.encoder().decodeFromURL(thisProject.getFolioDropdown());
                                                    } catch (Error e) {
                                                        fdrop = "<option>" + e.getLocalizedMessage() + "</option>";
                                                    } finally {
                                        out.print(fdrop.replace("'", "&apos;"));
                                        }%>');
                                        $(".folioDropdown").append(folioDropdown.html());
                                        $("#pageRange").find("select")
                                        .children("option").val(function(){
                                            return parseInt($(this).val(),10);
                                        }).end()
                                        .filter(":first").children("option:first").attr("selected",true).end().end()
                                        .filter(":last").children("option:last").attr("selected",true);
                                    </script>
                                </li>
                                <li id="exportTags" class="left ui-widget-content ui-corner-tr ui-corner-bl tall permitExport isMember">
                                    <h3>XML Tag Options</h3>
                                    <p class="xmlDisclaimer">Formatting XML tags is not possible with plaintext export.</p>
                                    <%
                                        textdisplay.TagFilter f = new textdisplay.TagFilter(textdisplay.Manuscript.getFullDocument(thisProject, true));
                                        String[] tags = f.getTags();
                                        out.print(tags.length + "</span> XML tags were detected in this text:<br />");
                                        out.print("<input type='hidden' name='projectID' value=" + projectID + " />");
                                        out.print("<span class='ui-button tpenButton xmlDisclaimer' state='off' id='xmlSelectAll'>Select All</span>");                                       
                                        for (int i = tags.length - 1; i > -1; i--) {
                                            out.print("<span class='xmlDisclaimer'><label for='removeTag" + (i + 1) + "' title='Check this box to remove the tag and its contents'><input type='checkbox' name='removeTag" + (i + 1) + "' />Remove &lt;" + tags[i] + "&gt;</label></span>");
                                            out.print("<span class='xmlHide'><label>" + tags[i] + "");
                                            out.print("<select name='style" + (i + 1) + "' >");
                                            out.print("<option value='none' selected>No Change</option>");
                                            out.print("<option value='italic' >Italic</option>");
                                            out.print("<option value='bold' >Bold</option>");
                                            out.print("<option value='underlined'>Underlined</option>");
                                            out.print("<option value='paragraph'>New Paragraph</option>");
                                            out.print("<option value='remove' >Remove</option>");
                                            out.print("</select></label><label for='stripTag" + (i + 1) + "' title='Check this box to strip this tag from around its content' class='right'><input type='checkbox' checked id='stripTag" + (i + 1) + "' name='stripTag" + (i + 1) + "' />Hide " + ESAPI.encoder().encodeForHTML("<tag>") + "</label><br><input type='hidden' name='tag" + (i + 1) + "' value='" + tags[i] + "'></span>");
                                        }
                                    %>
                                </li>
                                <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                    <div class="ui-state-error ui-corner-all" id="exportAlert"><span class="left ui-icon ui-icon-alert"></span>Notes cannot be displayed in continuous text at this time.</div>
                                    <h3>Notes</h3>
                                    <p class="xmlDisclaimer">Notes are not supported with plaintext export.</p>
                                    <span class="xmlHide">
                                                                <label id="sideBySide" for="notesSideBySide" title="Show notes to the side of each line"><input id="notesSideBySide" type="radio" name="notes" value="sideBySide"  />Side-by-side</label><br />
                                        <label id="noteLine" for="notesLine" title="Show notes underneath each line"><input id="notesLine" type="radio" name="notes" value="line" checked />Beneath each line</label><br />
                                        <label id="endnote" for="notesEndnote" title="Show notes at the end of the document"><input id="notesEndnote" type="radio" name="notes" value="endnote" />Endnotes</label><br />
                                        <label id="footnote" for="notesFootnote" title="Show notes after each page of the manuscript"><input id="notesFootnote" type="radio" name="notes" value="footnote" />Footnotes</label><br />
                                        <label id="noteRemove" for="notesRemove" title="Remove notes from exported document"><input id="notesRemove" type="radio" name="notes" value="remove" />Remove</label>
                                    </span>
                                    <h3 class="clear">Linebreaking Layout</h3>
                                    <label id="linebreakLine" class="xmlHide" title="Start each line of transcription on a new line" for="newline"><input id="newline" type="radio" name="linebreak" value="newline" checked />Start a new line</label><br />
                                                        <label id="linebreakPage" class="xmlHide" title="Linebreak only at a new page" for="pageonly"><input id="pageonly" type="radio" name="linebreak" value="pageonly" />Page break only</label><br />
                                    <label id="linebreakContinuous" title="Remove all linebreaks" for="inline"><input id="inline" type="radio" name="linebreak" value="inline" />Continuous text</label><br />
                                    <label id="exportHyphenation" class="" title="Use hyphenation to join words broken across lines" for="exportWordbreak"><input id="exportWordbreak" name="exportWordbreak" type="text" placeholder="/-/" value="<%//out.print(p.getWordbreakString);%>" /> custom word break string</label><br />
                                    <label id="exportLinebreak" class="" title="Use this string with linebreaking" for="exportLinebreakString"><input id="exportLinebreakString" name="exportLinebreakString" type="text" placeholder="&lsaquo;lb /&rsaquo;" value="<%//out.print(p.getLinebreakString);%>" /> custom line break string</label><br />
                                    <label id="exportUseLinebreakString" class="" for="useLinebreakingString" title="Use this string in exported document"><input id="useLinebreakingString" type="checkbox"  value="true"/>Use linebreak string in exported document</label>
                                </li>
                            </ul>   
                        </form>
                    </div>-->
<!--                                    <%}%>-->
                </div>
                <!--<a class="returnButton" href="../newberry/">Return to TPEN Homepage</a><br>-->
                <a class="returnButton returnToTrans" href="">Go To Project Transcription</a>
            </div>
        </div>
<!--<%if(isMember||permitModify){%>-->
            <div id="addToProject"> <!-- container for adding to projects -->
            <div class="callup" id="form"> <!-- add to project -->
                <span id="closePopup" class="right caps">close<a class="right ui-icon ui-icon-closethick" title="Close this window">cancel</a></span>
<!--                <%    //Attach arrays of AllCities and AllRepositories represented on newberry
                    String[] cities = Manuscript.getAllCities();
                    String[] repositories = Manuscript.getAllRepositories();
                %>-->
                <label class="left" for="cities">City: </label>
                <select class="left" name="cities" onchange="Manuscript.filteredCity();scrubListings();" id="cities">
                    <option selected value="">Select a City</option>
<!--                    <%  //Generate dropdown menus for available cities.
                        for (int i = 0; i < cities.length; i++) {
                            out.print("<option value=\"" + (cities[i]) + "\">" + cities[i] + "</option>");
                        }
                    %>-->
                </select>
                <label class="left clear" for="repositories">Repository: </label>
                <select class="left" name="repository" onchange="Manuscript.filteredRepository();scrubListings();" id="repositories">
                    <option selected value="">Select a Repository</option>
<!--                    <%  //Generate dropdown menus for available repositories.
                        for (int i = 0; i < repositories.length; i++) {
                            out.print("<option class=\"" + (i + 1) + "\" value=\"" + (repositories[i]) + "\">" + repositories[i] + "</option>");
                        }
                    %>-->
                </select>
                <div id="listings" class="center clear"  style="height:355px;overflow: auto;">
                    <div class="ui-state-active ui-corner-all" align="center">
                        Select a city or repository above to view available manuscripts.
                    </div>

                </div>
            </div>
        </div>


<div id="addingTools" class="ui-corner-all ui-widget ui-widget-content">
    <a id="closeAddingTools" href="#" onclick="$('#addingTools').fadeOut('normal');return false;" class="right tpenButton ui-button">Close<span class="ui-icon ui-icon-close right"></span></a>
    <h3>Add an iFrame Tool</h3>
<!--                    <iframe src="iframe.html" id="addToolFrame"></iframe>-->
    <input id="addToolName" type="text" maxlength="25" placeholder="Tool Name" />
    <input id="addToolURL" type="text" placeholder="Full URL of tool" />
    <a class="tpenButton" id="addToolPreview" 
       onclick="$('#addToolFrame').attr('src',$('#addToolURL').val());">
        Test Link
    </a>
    <a class="tpenButton" id="addToolCommit"
       onclick="addProjectTool();">
        Add
    </a><br>
    <div id="addToolInfo" class="clear-left">
        <p>
            Add a useful name and complete URL of the page you would like loaded as a tool.
        </p>
        <p>
            Some pages will not allow themselves to be loaded into an iFrame, so you should test your tool before adding it.
        </p>
        <p>
            These tools are connected to specific projects and will be available for all group members.
        </p>
    </div>
</div>

<div id="projectUserManagement">
    <div class="closeBtn" onclick="$('#projectUserManagement').hide();">X</div>
</div>

<div id="folioManagement">
   
</div>

<div id="buttonManagement">
    
</div>
</body>
<!--        <%@include file="WEB-INF/includes/privateUpload.jspf" %>
        <%@include file="WEB-INF/includes/projectTitle.jspf" %>-->
<script type="text/javascript">
    
var currentProjectID = 4351; 
$("#activeProjectID").val(currentProjectID);
var minWidth = 10;
var selecTab = null;
var currentUser = {uname:"", uid:-1};
var folioOrderedList = [];
var isMember=permitOACr=permitOACw=permitExport=permitCopy=permitModify=permitAnnotation=permitButtons=permitParsing=permitMetadata=permitNotes=permitRead=false;
var userIsProjectAdmin = false;
/* 
 * Get the required information to properly load the page, then run the functions to populate.  
 * You will need to get the projectID of the project being managed (either from the url variable or elsewhere, I am not sure how we enter this page yet.
 * You will need to know the username of the current logged in user and that user's userID. 
 * Once you have that, you can call the other API functions that give you the rest of the information you need throughout the functions on this page. 
 */
function getPreloadInformation(){
    //currentProjectID = 4352; However we know this when we get to this page, it is crucial that it get recorded;
    var url = "geti";
    var pageurl = document.location.href;
    var projectID = "";
    if(pageurl.indexOf("projectID=") === -1 || parseInt(pageurl.indexOf("?projectID="))+11 === pageurl.length){
        alert("you must provide a project ID");
        return false;
    }
    projectID = pageurl.substr(pageurl.indexOf("?projectID=")+11, pageurl.length -1);
    if(+projectID === parseInt(projectID)){
        //It is an integer, we can continue
    }
    else{
        alert("The id provided is not a number, so it is not a valid ID.  make sure there are no spaces, letters or punctuation marks in the ID.");
        return false;
    }
    $(".returnToTrans").attr("href","newberryTrans.html?projectID="+projectID);
    currentProjectID = parseInt(projectID);
    $("#activeProjectID").val(currentProjectID);
    $.ajax({
        url: url,
        type: "GET",
        dataType: "json",
        success: function(data){
            //console.log('CURRENT USER INFORMATION: ');
            //console.log(data);
            currentUser = data;
            if(data.uname && data.uname !== ""){
                loggedInUser = true;
                getActiveProjectMetadata(currentProjectID);
            }
            else{
                loggedInUser = false;
                alert("You must be logged in.");
            }
            
        },
        error: function(jqXHR,error, errorThrown) {  
            //probably just not logged in
                alert("The server could not tell me what user you are or you don't have permission to be on this page.");
        }
    });
}

function updatePublicOptions(){
    var url= "changeUserPermission";
    
    var params = {act:"cpm" , projectID:currentProjectID};
    $('#publicOptionsForm').find('input[type="checkbox"]').each(function(){
        var optionName = $(this).attr('name');
        switch(optionName){
            case "OACr":
                if($(this).is(':checked')){
                    params.allowOACRead = true;
                }
                else{
                    params.allowOACRead = false;
                }
                break;
            case "OACw":
                if($(this).is(':checked')){
                    params.allowOACWrite = true;
                }
                else{
                    params.allowOACWrite = false;
                }
                break;
            case "readTrans":
                if($(this).is(':checked')){
                   params.allowPublicReadTranscription = true;
                }
                else{
                   params.allowPublicReadTranscription = false;
                }
                break;
            case "publicExport":
                if($(this).is(':checked')){
                    params.allowExport = true;
                }
                else{
                    params.allowExport = false;
                }
                break;
            case "projectCopy":
                if($(this).is(':checked')){
                    params.allowPublicCopy = true;
                }
                else{
                    params.allowPublicCopy = false;
                }
                break;
            case "modNotes":
                if($(this).is(':checked')){
                    params.allowPublicModifyNotes = true;
                }
                else{
                    params.allowPublicModifyNotes = false;
                }
                break;
            case "modTrans":
                if($(this).is(':checked')){
                    params.allowPublicModifyTranscription = true;
                }
                else{
                    params.allowPublicModifyTranscription = false;
                }
                break;
            case "modAnno":
                if($(this).is(':checked')){
                    params.allowPublicModifyAnnotations = true;
                }
                else{
                    params.allowPublicModifyAnnotations = false;
                }
                break;
            case "modParsing":
                if($(this).is(':checked')){
                    params.allowPublicModifyLineParsing = true;
                }
                else{
                    params.allowPublicModifyLineParsing = false;
                }
                break;
            case "modButton":
                if($(this).is(':checked')){
                    params.allowPublicModifyButtons = true;
                }
                else{
                    params.allowPublicModifyButtons = true;
                }
                break;
            case "modMetadata":
                if($(this).is(':checked')){
                    params.allowPublicModifyMetadata = true;
                }
                else{
                    params.allowPublicModifyButtons = false;
                }
                break;
            default:
                alert('Unknown Project Option');
              
        }
    });
    $.post(url, params);
//if(jqXHR.status && jqXHR.status==403){
//                 alert("The project to modify user permission does not exist."); 
//            }
//            else if(jqXHR.status && jqXHR.status==406){
//                 alert("The role name or permission to modify was invalid.");
//            }
//            else if(jqXHR.status && jqXHR.status==0){
//                alert('User is not a member of this site.')
//            }
//            else if(jqXHR.status && jqXHR.status==1){
//                //Success?
//            }
//            else if(jqXHR.status && jqXHR.status==11){
//                alert('User is already a memeber of this project.')
//            }
}

function showTeamMemberManagement(){
    if(userIsProjectAdmin){
        $('#projectUserManagement').show();
    }
}

function populateEditableXML(xmlTags){
    xmlTags = xmlTags.split("</span>"); // make a array by </span?
    var tagsInOrder = [];
    for (var tag = 0; tag < xmlTags.length; tag++){ //FIXME!!!How can I get these in order?  Order them after they are in the DOM?
//                        var thisTag = xmlTags[tag];
//                        var position1 = thisTag.position;
//                        var tagText = thisTag.text;
//                        var description = thisTag.description;
//                        var color = thisTag.color;
        var newTagBtn = xmlTags[tag];
        if(newTagBtn!=="" && newTagBtn!==" "){
             tagsInOrder.push(newTagBtn + "</span>");
        }

        //tagsInOrder[position1] = newTagBtn;
    }
}
    
function populateEditableChars(specialCharacters){
    specialCharacters = JSON.parse(specialCharacters);
    var speCharactersInOrder = new Array(specialCharacters.length);
    for (var char = 0; char < specialCharacters.length; char++){
            var thisChar = specialCharacters[char];
            if(thisChar == ""){

            }
            else{
                var keyVal = thisChar.key;
                var position2 = parseInt(thisChar.position);
                var newCharacter = "<button onclick=\"addchar('&#"+keyVal+";');\" class='character'>&#"+keyVal+";</button>";
                if(position2-1 >= 0 && (position2-1) < specialCharacters.length){
                    speCharactersInOrder[position2-1] = newCharacter; 
                }
            }

        }
    }

function getActiveProjectMetadata(currentProjectID){
    var isPublicProject = false;
    //console.log("GET METADATA");
    //Check if is public project and set this variable.
    var url = "getProjectTPENServlet?projectID="+currentProjectID;
    $.ajax({
        url: url,
        type:"GET",
        success: function(activeProject){
            //console.log("ACTIVE PROJECT INFORMATION");
            //console.log(activeProject);
            var leader = activeProject.ls_leader;
            
            leader = JSON.parse(leader);
            //console.log('ADMIN CHECK');
            //console.log(leader[0].UID+"=="+currentUser.uid+"?");
            if(leader[0].UID == currentUser.uid){
                userIsProjectAdmin = true;
                $('.mustBeAdmin').show();
                
            }
            $('.metadataLeader').html(leader[0].fname +"&nbsp;"+leader[0].lname+"&nbsp;&nbsp;("+leader[0].Uname+")");
            
            var users = activeProject.ls_u;
            users=JSON.parse(users);
            $.each(users,function(){
                var leaderTag = "";
                var removeUser = "<a class='removeUser' onclick=\"removeUserFromProject('"+this.Uname+"', $(this).parent());\">Remove member</a>";
                var promoteUser = "<a class='promoteUser' title='Promote this user to Group Leader' onclick='promoteUserToAdmin("+this.UID+");' > + </a>";
                if(this.UID == currentUser.uid){
                    isMember = true;
                    if(userIsProjectAdmin){
                        leaderTag = " (Leader) ";
                        removeUser = "";
                        promoteUser = "";
                    }
                    $('.isMember').show();
                }
               $('#projectMembers').append("<li userID='"+this.UID+"'><span class='userFname'>"+this.fname+" </span><span class='userLname'>"+this.lname+"</span><span style='margin-left:5px;' class='userEmail'>("+this.Uname+")</span><span class='userFname'>"+leaderTag+"</span></li>");               
               //reference groups.html to find this html element.
               $('#editProjectMembers').append("<li>"+promoteUser+"<span>" + this.Uname + leaderTag + "</span>"+removeUser+"</li>");
            });  
            
            var publicProperties = activeProject.projper;
            publicProperties = JSON.parse(publicProperties);
            
            permitOACr = publicProperties.allow_OAC_read;
            permitOACw = publicProperties.allow_OAC_write;
            permitExport = publicProperties.allow_public_export;
            permitCopy = publicProperties.allow_public_copy;
            permitModify = publicProperties.allow_public_modify;
            permitAnnotation = publicProperties.allow_public_modify_annotation;
            permitButtons = publicProperties.allow_public_modify_buttons;
            permitParsing = publicProperties.allow_public_modify_lines_parsing;
            permitMetadata = publicProperties.allow_public_modify_metadata;
            permitNotes = publicProperties.allow_public_modify_notes;
            permitRead = publicProperties.allow_public_read_transcription;
            
            
            if(permitOACr){
                $('#OACr').attr('checked', 'checked');
            }
            if(permitOACr){
                $('#OACw').attr('checked', 'checked');
            }
            if(permitAnnotation){
                $('#modAnno').attr('checked', 'checked');
            }
            if(permitParsing){
                $('#modParsing').attr('checked', 'checked');
            }
            if(permitNotes){
                $('#modNotes').attr('checked', 'checked');
            }
            if(permitRead){
                $(".permitRead").show();
                $('#readTrans').attr('checked','checked');
            }
            if(permitModify){
                $(".permitModify").show();
                $('#modTrans').attr('checked', 'checked');
            }
            if(permitButtons){
                $(".permitButtons").show();
            }
            if(permitMetadata){
                $(".permitMetadata").show();
                $('#modMetadata').attr('checked', 'checked');
            }
            if(permitCopy){
                $(".permitCopy").show();
                $('#projectCopy').attr('checked','checked');
            }
            if(permitExport){
                $(".permitExport").show();
                $('#publicExport').attr('checked','checked');
            }
            
            var projectInformation = activeProject.metadata;
            projectInformation = JSON.parse(projectInformation);
            //console.log("get project information");
            //console.log(projectInformation);
            var projectTitle = projectInformation.title;
            var projectSubtitle = projectInformation.subtitle;
            var msIdentifier = projectInformation.msIdentifier;
            var msSettlement = projectInformation.msSettlement;
            var msRepository = projectInformation.msRepository;
            var msCollection = projectInformation.msCollection;
            var msIDNumber = projectInformation.msIdNumber;
            var author = projectInformation.author;
            var date = projectInformation.date;
            var location = projectInformation.location;
            var language = projectInformation.language;
            var description = projectInformation.description;
            var subject = projectInformation.subject;
            
            var specialCharacters = activeProject.projectButtons;
            var xmlTags = activeProject.xml;
            populateSpecialCharacters(specialCharacters);
            populateXML(xmlTags);
            
            populateEditableXML(xmlTags);
            populateEditableChars(specialCharacters);
            
            //for all non-input areas
            $('.metadataTitle').html(projectTitle);
            $('#activeProjectName').html(projectTitle);
            $('.metadataSubtitle').html(projectSubtitle);
            $('.metadataMSID').html(msIdentifier);
            $('.metadataMSIDnum').html(msIDNumber);
            $('.metadataCollection').html(msCollection);
            $('.metadataSettlement').html(msSettlement)
            $('.metadataRepository').html(msRepository);
            $('.metadataSubject').html(subject);
            $('.metadataAuthor').html(author);
            $('.metadataDate').html(date);
            $('.metadataLocation').html(location);
            $('.metadataLanguage').html(language);
            $('.metadataDescription').html(description);
            
            //for all input areas.  
            $('.metadataTitle').val(projectTitle);
            $('#activeProjectName').val(projectTitle);
            $('.metadataSubtitle').val(projectSubtitle)
            $('.metadataMSID').val(msIdentifier);
            $('.metadataMSIDnum').val(msIDNumber);
            $('.metadataCollection').val(msCollection);
            $('.metadataSettlement').val(msSettlement)
            $('.metadataRepository').val(msRepository);
            $('.metadataSubject').val(subject);
            $('.metadataAuthor').val(author);
            $('.metadataDate').val(date);
            $('.metadataLocation').val(location);
            $('.metadataLanguage').val(language);
            $('.metadataDescription').val(description);
           
            //getPageName
            //getImageURL
            //getCollectionName
            //getFolioNumber
            var folioList = activeProject.ls_fs;
            folioList = JSON.parse(folioList);
            
            $.each(folioList, function(){
//                $("#manuscriptViewer").append("<li class='folios' title='"+folios[i].getCollectionName()+" "+folios[i].getPageName()+"'>\n\
//                <span class=\"clicked ui-icon ui-icon-arrowthick-1-e right\" title='Move a single image into the holding area'></span>\n\
//                <span class=\"discard ui-icon ui-icon-trash right\" title='Discard a single folio'></span><span class=\"imagePreview ui-icon left\" data-imgUrl="+folios[i].getImageURL() +"></span>\n\
//                <input type=\"hidden\" name=\"folio[]\" id=\""+folios[i].getFolioNumber()+"\" value=\""+folios[i].getFolioNumber()+"\"/>\n\
//                <span class='collection'>"+folios[i].getCollectionName()+"</span> <span class='pageName'>"+folios[i].getPageName()+"</span></li>")
            });
            
            var userToolList = activeProject.userTool;
            $.each(userToolList, function(){
                //Load these into the tool section for project editing
            });
            var projectToolList = activeProject.projectTool;
            projectToolList = JSON.parse(projectToolList);
            $.each(projectToolList, function(){
                //console.log("tool");
                //console.log(this);
                var toolLabel = this.name;
                var toolURL = this.url;
                var toolID = this.id;
                var projectTool = "<label class='projectTool'><input name='projectTool' type='checkbox' value='"+toolURL+"' title='"+toolLabel+"' toolName='"+toolLabel+"'/>"+toolLabel+"</label>";
                $("#projectTools").append(projectTool);
                //Load these into the tool section for project editing
            });
                     
            var projectManuscriptMetadata = activeProject.ls_ms;
            projectManuscriptMetadata = JSON.parse(projectManuscriptMetadata);
            //console.log("MANUSCRIPT METADATA");
            //console.log(projectManuscriptMetadata[0]);
            $('#linebreakNotice').html("Preview limited to first "+projectManuscriptMetadata[0].linebreakCharacterLimit+" characters.");            
            getUserProjects(currentProjectID, currentUser.uid, currentUser.uname);
        },
        error: function(jqXHR,error, errorThrown) {  
            //console.log("there was an error");
            if(jqXHR.status && jqXHR.status==400){
                 alert(jqXHR.responseText); 
            }
            else{
                alert("Could not retrieve project "+currentProjectID);
            }
       }
    });
    

//    $("#buttonManagement").load("buttons.html"); //include button management popover
    
}




function deleteProject(projID, elem){
    var url = "delProject";
    var params = {projectID:projID};
    $.post(url, params)
            .done(function(){
                $("#projectList").children("li[projectID='"+projID+"']").remove();
    });
}

function getUserProjects(projectID, userID, username){
    var url = "projects?username="+username;
    //How can I check if current user is the admin of the project? 
    var projectName = "";
    $.ajax({
        url: url,
        type:"GET",
        success: function(data){
            var userProjects = data;
            $.each(userProjects, function(){
                projectName = this.name;
                var projectID = this.id;
                projectID = projectID.replace("projects/", "");
                //console.log('User is admin: '+userIsProjectAdmin)
                if(!userIsProjectAdmin){
                    $('#projectList').append("<li><a title=\"" + projectName + "\" class=\"tpenButton projectTitle\" href='project.html?projectID="+projectID+"'>"+projectName+"</a></li>");
                }
                else{
                    $('#projectList').append("<li projectID='"+projectID+"'>\n\
                    <a title=\"" + projectName + "\" class=\"tpenButton projectTitle\" href='project.html?projectID="+projectID+"'> "+projectName+" </a>\n\
                    <span style='z-index:1000; cursor:pointer;' title=\"delete project\" class=\"delete ui-icon ui-icon-closethick right\" onclick=\"deleteProject("+projectID+");\"></span>\n\
                    </li>");
            //<span style='z-index:1000; cursor:pointer;' title=\"delete project\" class=\"delete ui-icon ui-icon-closethick right\" onclick=\"deleteProject();\"></span>
                }
            });
        },
        error: function(jqXHR,error, errorThrown) {  
            if(jqXHR.status && jqXHR.status==400){
                 alert(jqXHR.responseText); 
            }
            else if (jqXHR.status && jqXHR.status==404){
                alert("A project does not exist with this ID:"+projectID+".  Try with a different ID.");
            }
        }
    });
}

function modifyUserPermissions(act){
    var permissionString = "";
    var dataObject = {};
    var url = "changeUserPermission";
    if(act === "changerole"){
        var roleName = "";
        //Add role names based on UI here.
        dataObject.act = "changerole";
        dataObject.role = roleName;
    }
//    else if (act === "cpm"){
//        var cpmCommand = "";
//        dataObject.act = "cpm";
//        //Create cpmCommand string based on UI selection. 
//        url += "";
//    }
    $.post(url, dataObject);
//if(jqXHR.status && jqXHR.status==403){
//                 alert("The project to modify user permission does not exist."); 
//            }
//            else if(jqXHR.status && jqXHR.status==406){
//                 alert("The role name or permission to modify was invalid.");
//            }
//            else if(jqXHR.status && jqXHR.status==0){
//                alert('User is not a member of this site.')
//            }
//            else if(jqXHR.status && jqXHR.status==1){
//                //Success?
//            }
//            else if(jqXHR.status && jqXHR.status==11){
//                alert('User is already a memeber of this project.')
//            }

}


function equalWidth(){
    $("#allXML").children("span").each(function(){
        minWidth = ($(this).width()>minWidth) ? $(this).width() : minWidth;
    }).css({"min-width":minWidth+"px"});
}
            
function equalHeights (eClass, minHeight){
    var minHeight = minHeight;
    var lis = $(".toptbas").children("li");
    var tabIndex = -1;
    var count = 0;
    $.each(lis, function(){
        count++;
        if($(this).attr("class").indexOf("ui-state-active") > -1){
            tabIndex = count;
            $("#tabs-"+tabIndex).find("."+eClass).each(function(){
                minHeight = ($(this).height()>minHeight) ? $(this).height() : minHeight; 
            });
            $("#tabs-"+tabIndex).find("."+eClass).css({"min-height":minHeight+"px"});
        }
    });
    
}

$(function() {
        $('#tabs').tabs({ 
            fx: { opacity: 'toggle', duration:250 },
            show: function(ui) {equalHeights("tall",100);equalWidth();}
        });
        getPreloadInformation();
        $('#editProjectMetadata').load("projectMetadata.html"); //include projectMetadata popover for editing metadata.
        $('#projectUserManagement').load("groups.html"); // include group management popover
        $('#folioManagement').load("projSequence.html");// include folio management popover
        $("#copyProjectBtn").click(function(){
            var cfrm = confirm('All transcriptions, parsings, and buttons will be copied into a new project.\n\nContinue?');
            return cfrm;
        });
        $("#xmlSelectAll").click(function(){
            if ($(this).attr('state') == "on"){
                $(this).text("Select All").attr('state','off');
                $("[name^='removeTag']").attr("checked",false);
            } else {
                $(this).text("Deselect All").attr('state','on');
                $("[name^='removeTag']").attr("checked",true);
            }
        });
        $("#export").find("button").hover(function(){$(this).toggleClass("ui-state-hover")});
        $( "#popupNote").click(function() {
            $( "#noteForm" ).fadeIn(1000);
            return false;
        });
        $( "#clearNote").click(function() {
            $( "#noteForm" ).fadeOut(500);
            return false;
        });
        
        if (selecTab) $('#tabs').tabs('option','selected',selecTab);
        $('span.delete').hover(
        function(){$(this).parent('li').find("a.tpenButton").addClass     ("ui-state-error strikeout");},
        function(){$(this).parent('li').find("a.tpenButton").removeClass  ("ui-state-error strikeout");}
    );
        $(".formatDiv").addClass('ui-corner-all');
        $(".format").click(function(){
            $(this).next("div.formatDiv").slideToggle(500);
        });
        $("#addManuscript").click(function(){
            $("#wrapper").append("<div class='ui-widget-overlay' id='overlay' style='display:none;'></div>");
            $("div#addToProject,#overlay").show('fade',500);
        });
        $("#closePopup").click(function(){
            $("div#addToProject,#overlay").hide('fade',500,function(){
                $("#overlay").remove();
            });
        });
        $("#xmlImportBtn,#inviteUserBtn,#templateBtn").click(function(){
            $(this).toggleClass("ui-state-active")
            .next("form").add("#QENIx").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#xmlValidateBtn").click(function(){
            $("#xmlValidate").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#linebreakingBtn").click(function(){
            $("#linebreaking").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#wordbreakBtn").click(function(){
            $("#wordbreak").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
//                                        $("#logFilter a").not($("#openNote")).hide(); //delete this line to enable the filters on the projectLog
        $("#logFilter a").not($("#openNote")).click(function(){
            $(this).toggleClass('ui-state-disabled');
            $("#projectLog div."+$(this).attr("filter")).parent().parent().slideToggle();
        });
        /* Handlers for Export Options */
        $("#inline, #pageonly").click(function(){
            if(this.checked) {
                $("#exportAlert").slideDown();
                $("#exportHyphenation").attr("disabled",false);
            }
            if($("#notesLine").attr("checked") || $("#notesSideBySide").attr("checked")){
                $("#notesRemove").attr("checked", true);
                //alert("Notes options were incompatable with this selection and have been changed.");
            }
            if(this.id=="inline") $("#notesFootnote").attr("disabled",true);
            $("#notesSideBySide, #notesLine").attr("disabled",true);
        });
        $("#newline").click(function(){
            if(this.checked) $("#exportHyphenation").attr("disabled",true);
            $("#notesSideBySide, #notesLine, #notesFootnote").attr("disabled",false);
        });
        $("#notesSideBySide,#notesLine").click(function(){
            if(this.checked) {
                $("#exportAlert").slideDown();
                $("#exportWordbreak, #pageonly, #inline").attr("disabled",true);
                if($("#pageonly").attr('#checked')||$("#inline").attr('checked')) {
                    //alert('Linebreaking options were incompatable with your selection and have been changed.');
                }
                $("#newline").attr({'checked': true,'disabled':false});
            }
        });
        $("#notesEndnote,#notesFootnote,#notesRemove").click(function(){
            if(this.checked) {
                $("#exportWordbreak, #newline, #exportLinebreakString, #useLinebreakString, #pageonly, #inline").attr("disabled",false);
                $("#exportAlert").slideUp();
            }
        });
        //                $("#metadataOption").click(function(){
        //                    if ($("#metadataSelect").is(":checked")) $("#metadataPreview").slideDown();
        //                    else $("#metadataPreview").slideUp();
        //                })
        $("#pdf,#rtf").click(function(){
            if(this.checked) {
                $(".xmlHide").show();
                $(".xmlDisclaimer").hide();
                $("#color").attr("disabled",false);
            }
        });
        $("#xml").click(function(){
            if(this.checked) {
                var areChanges = false;
                $(".xmlHide").hide();
                $(".xmlDisclaimer").show();
                $("#color").attr("disabled",true);
                if ($("#color").attr("checked")){
                    areChanges = true;
                    $("#bw").attr("checked",true);
                }
                if ($("#notesSideBySide,#notesEndnote,#notesFootnote,#notesLine").attr("checked")) {
                    areChanges = true;
                    $("#notesRemove").attr("checked",true);
                }
                if ($("#pageonly,#newline").attr("checked")) {
                    areChanges = true;
                }
                $("#inline").attr("checked",true);
                //if (areChanges) alert("Some selections are not supported in plaintext export and have been changed.");
            }
        });
        $(".beginFolio,.endFolio").change(function(){
            var thisIs = ($(this).hasClass('beginFolio')) ? "beginFolio" : "endFolio";
            $('.'+thisIs).val(this.value);
            var first = $(this).parent().find(".beginFolio");
            var last = $(this).parent().find(".endFolio");
            var firstFolio = first.children("option:selected").index();
            var lastFolio = last.children("option:selected").index();
            if (firstFolio > lastFolio) {
                first.add(last).addClass("ui-state-error").attr("title","Folio range does not include any pages.");
                $('#submitLimit').prop('disabled',true).addClass('ui-state-disabled');
            } else {
                first.add(last).removeClass("ui-state-error").attr("title","");
                $('#submitLimit').prop('disabled',false)
                    .removeClass('ui-state-disabled')
                    .html("Submit Set Range");
            }
        });

        $(".partnerListing").find("input:radio").click(function(event){
            event.preventDefault();
        });
        $("#QENI").find(".partnerListing").click(function(){
            $(this).find("input:radio").attr("checked",true);
            $("#QENI").scrollTop(0).find("input:checked")
            .parent(".partnerListing")
            .addClass("ui-state-active")
            .fadeOut(250,function(){
                $(this).css("opacity", 0)
                .prependTo("#QENI").slideDown()
                .animate({"opacity":1},250)
            })
            .siblings().removeClass("ui-state-active");
            if($("#QENI").parent("form").find("input[type='submit']").hasClass('hide')){
                $("#QENI").parent("form").find("input[type='submit']").slideDown().removeClass('hide');
            }
        });
        $("#disconnect").find(".partnerName").click(function(event){
            if(event.target != this){return true;}
            $("#tabs").tabs("select",4);
            setTimeout('$("#tpenSubmit").click()',350);
        })
        .find(".ui-icon-closethick").bind({
            mouseenter: function(){
                $("#deleteConnection").stop(true,true).slideDown();
                $("#disconnect").addClass("ui-state-error");
            },
            mouseleave: function(){
                $("#deleteConnection").stop(true,true).slideUp();
                $("#disconnect").removeClass("ui-state-error");
            },
            click: function(){
                $("#disconnect").find("input:radio").attr("checked",true);
                $("#QENI").find(".partnerListing").removeClass("ui-state-active")
                .parents("form").find("input[type='submit']").click();
            }
        })
        $("#template").find("input:text").keyup(function(){
            $("#template").find(".partnerName").html($(this).val());
        }).end()
        .find("textarea").keyup(function(){
            $("#template").find(".partnerDescription").html($(this).val());
        });
        $("#toolSelection").submit(function(){
            $(this).find(".projectTools").each(function(){
                var thisInput = $(this).find("input");
                thisInput.val($(this).find("span").text()+"TPENTOOLURL"+thisInput.val());
            });
        });
        $(".publicLabel").children('input').on('change',function(){$("#publicOptionResult").fadeOut('slow');});
        $("#samplePreview").hover(function(){
            $(this).find("img").css({
                "width" :   "auto",
                "height":   "auto"
            });
            var posX = $(this).offset().left;
            var posY = $(this).offset().top;
            var sampleX = $(this).width();
            var sampleY = $(this).height();
            var imgX = $(this).find("img").width();
            var imgY = $(this).find("img").height();
            var imgLeft = 0;
            var imgTop= 0;
            $(document).bind('mousemove', function(e){
                imgLeft = -(e.pageX-posX) * (imgX-sampleX-68) / sampleX;    // 68 pixel nudge for padding and box-model inconsistencies
                imgTop  = -(e.pageY-posY) * (imgY-sampleY-30) / sampleY;    // 30 pixel nudge for padding and box-model inconsistencies
                //alert("e.pageX:"+e.pageX+"\nposX:"+posX+"\nposY:"+posY+"\nsampleX:"+sampleX+"\nsampleY:"+sampleY+"\nimgLeft:"+imgLeft+"\nimgTop:"+imgTop);
                $("#samplePreview").find("img").css({
                    "left"  :   imgLeft,
                    "top"   :   imgTop
                });
//                        $("#samplePreview span").html(Math.round(e.pageY)+", "+Math.round(posY)+", "+Math.round(sampleY));
            });
        },function(){
            $(this).find("img").css({
                "width" :   "100%",
                "height":   "100%",
                "top"   :   "30px",
                "left"  :   0
            });
            $(document).unbind('mousemove');
        }).find("img").css({
            "width" :   "100%",
            "height":   "100%"
        });
        
        $("#addT").click(function(){
        var addTagData = {projectID:projectID};
        $.post("addTag", $.param(addTagData),function(data){
            var position = data;    //tag position from servlet
            $("#sortable2").children("li").eq(-1).clone(true).appendTo($("#sortable2"))
            .children("input.description").attr("name", "description"+position).val("New Tag").end()
//                    .children("input.colors").attr("name","xmlColor"+position).val("black").end()
            .children(".xmlParams").find("input").each(function(index,param){
                var rename = (index > 0) ? "b"+position+"p"+index :  "b"+position;
                $(param).attr("name", rename).val("");
            });
            $("[name='b"+position+"']").val("New Tag");                        
        },"html");           
    });
    $("#addH").click(function(){
        var addHotkeyData = {projectID:projectID};
        $.post("addHotkey", $.param(addHotkeyData),function(data){
            var position = data;    //tag position from servlet
            $("#sortable1").children("li").eq(-1).clone(true).appendTo($("#sortable1"))
            .children("input.label").attr("id", "a"+position+"a").val("-").end()
            .children("input.shrink").attr({
                "name":"a"+position,
                "id":"a"+position
            }).val("42").end()
            .children("a").attr("onclick","deleteHotkey("+position+");");
        },"html");           
    });
    $( "#sortable1, #sortable2" ).sortable({
        connectWith: ".connectedSortable",
        placeholder: "ui-state-highlight ui-state-disabled",
        axis:'y'
    })
    .css("cursor","move");
    
    $(".tag").children('input').change(function(){
        unsavedAlert('#tabs-2');
        isValidTag(this);
    });
    $(".moreParameters").click(function(){
        $(this)
            .hide()
            .parent().next().slideDown();
    });
    $(".xmlPanel").focusin(function() {
        $(".xmlPanel").not(this).each(function(){collapsePanel(this);});
        expandPanel(this);
    });
    $('.toggleXML').click(function(){
        if ($(this).hasClass("ui-icon-arrow-4")) {
            expandPanel($(this).parent("li"));
        } else {
            collapsePanel($(this).parent("li"));
        }
    });
});

    function navigateTo(dropdown){
        $("body").addClass(" ui-state-disabled");
        document.location='transcription.jsp?p='+dropdown.value;
    }
    
    var selectWordbreak = "-";
    function customWordbreak(){
        selectWordbreak = $('#userWord').val();
        $("#currentSetting").html(selectWordbreak);
    }
    
    function scrubListings (){
        $("#listings").ajaxStop(function(){
            $("#listings a[href *= 'transcription']").hide();
        });
    }
    
    function addProjectTool() {
        var name=$("#addToolName").val();
        var URL=$("#addToolURL").val();
        if(name.length<1){
            $("#addToolName").addClass('ui-state-error').one('change',function(){$(this).removeClass('ui-state-error')});
            return false;
        }
        if(URL.length<5){
            $("#addToolURL").addClass('ui-state-error').one('change',function(){$(this).removeClass('ui-state-error')});
            return false;
        }
        var newTool = ['<label class="projectTool"><input type="checkbox" checked="true" value="',
                URL,'" title="',name,'"><span contenteditable="true">',name,'</span></label>'].join('');
            $(".projectTools").eq(0).before(newTool);
            $("#addingTools").fadeOut();
        var url = "addProjectToolServlet";
        var params = {"name":name, "projectID":4351, "url":URL };
        $.post(url, params);

    }
        
    function addUserTool(){
    
    }

    function removeProjectTool(){

    }

    function removeUserTool(){

    }
    
function expandPanel(btn) {
    $(btn)
        .find(".collapseXML").switchClass("collapseXML","expandXML").end()
        .find(".ui-icon-arrow-4").switchClass("ui-icon-arrow-4","ui-icon-arrowstop-1-n").end()
        .find(".xmlParams").slideDown();
}
function collapsePanel(btn) {
    $(btn)
        .find(".xmlParams").slideUp().end()
        .find(".expandXML").switchClass("expandXML","collapseXML").end()
        .find(".ui-icon-arrowstop-1-n").switchClass("ui-icon-arrowstop-1-n","ui-icon-arrow-4");
}
function unsavedAlert(idRef) {
    $("#tabs").find("a[href='"+idRef+"']").next().stop(true,true).show("pulsate","fast");
}
function deleteHotkey(position){
    $("#buttonForm")
        .append("<input type='hidden' value=true name='deletehotkey'/><input type='hidden' value="+position+" name='position'/>")
        .submit();
}
function deleteTag(position){
    $("#buttonForm")
        .append("<input type='hidden' value=true name='deletetag'/><input type='hidden' value="+position+" name='position'/>")
        .submit();
}
function rebuildOrder() {
        //interrupt saving if bad data is included
        if($(".badInfo").length > 0){
            var thisValue = $(".badInfo").val();
            alert("\""+thisValue+"\" is not valid unicode.\n\nPlease enter a number from 32-65518.");
            $(".badInfo").show('pulsate',500);
            return false;
        }
        var hotkeyLoop = $("#tabs-1").find("input:text").not(".label");
        var xmlLoop = $("#tabs-2").find("input:text");
        for (i=0;i<hotkeyLoop.length;i++){
            hotkeyLoop[i].name = "a"+(i+1);
        }
        for (i=0;i<xmlLoop.length;i=i+7) {
            xmlLoop[i].name = "description"+(i/7+1);
//            xmlLoop[i+1].name = "xmlColor"+(i/8+1);
            xmlLoop[i+1].name = "b"+(i/7+1);
            for (j=0;j<5;j++){                  //parameters
                xmlLoop[i+2+j].name = "b"+(i/7+1)+"p"+(j+1);
                if (xmlLoop[i+2+j].value == 'null') xmlLoop[i+2+j].value = '';
            }
        }
        return true;
    }
    
                              
</script>
</html>
